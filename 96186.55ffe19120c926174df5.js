"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[96186],{744380:(t,e,i)=>{i.d(e,{IntervalsVisibilitiesProperty:()=>o});var s=i(905520),n=i(816541);class o extends s.Property{state(t,e){return(0,n.nonDefaultIntervalsVisibilities)(super.state(t,e))??void 0}storeStateIfUndefined(){return!1}}},790394:(t,e,i)=>{i.d(e,{LineDataSourcePointIndexProperty:()=>n});var s=i(905520);class n extends s.Property{constructor(t,e){super(),this._waitingPointsetUpdate=!1,this._lineSource=t,this._pointIndex=e,this._cachedIndex=this.value()}value(){const t=this._lineSource.points();return 0===t.length?this._cachedIndex:t[this._pointIndex].index}setValue(t){this._cachedIndex=t;const e=this._lineSource.points(),i=t=>{const e=this._lineSource.points()[this._pointIndex];if(e.index===t)return;e.index=t,this._lineSource.startChanging(this._pointIndex,e),this._setPointImpl(e),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this,"");const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)};if(0===e.length){const t=()=>{i(this._cachedIndex),this._waitingPointsetUpdate=!1};if(this._waitingPointsetUpdate)return;this._lineSource.pointsetUpdated().subscribe(this,t,!0),this._waitingPointsetUpdate=!0}else i(t)}_setPointImpl(t){this._lineSource.setPoint(this._pointIndex,t)}}},34733:(t,e,i)=>{i.d(e,{LineDataSourcePointPriceProperty:()=>o});var s=i(650151),n=i(905520);class o extends n.Property{constructor(t,e){super(),this._lineSource=t,this._pointIndex=e,t.pointAdded().subscribe(this,(t=>{this._pointIndex===t&&this._listeners.fire(this,`${t}`)})),t.pointChanged().subscribe(this,(t=>{this._pointIndex===t&&this._listeners.fire(this,`${t}`)}))}value(){const t=this._lineSource.points()[this._pointIndex].price,e=(0,s.ensureNotNull)(this._lineSource.ownerSource()).formatter();if(e.parse){const i=e.format(t),s=e.parse(i);return s.res?s.value:t}return t}setValue(t){const e=this._lineSource.points()[this._pointIndex];e.price=parseFloat(""+t),this._lineSource.startChanging(this._pointIndex,e),this._lineSource.setPoint(this._pointIndex,e),this._lineSource.model().updateSource(this._lineSource),this._listeners.fire(this,"");const i=this._lineSource.endChanging(!0,!1);this._lineSource.syncMultichartState(i)}}},231842:(t,e,i)=>{i.d(e,{LineToolPriceAxisView:()=>r});var s=i(650151),n=i(597331),o=i(534328);class r extends n.PriceAxisView{constructor(t,e){super(),this._source=t,this._data=e,this._properties=t.model().properties().childs().scalesProperties}_updateRendererData(t,e,i){t.visible=!1;const s=this._source.model();if(!s.timeScale()||s.timeScale().isEmpty())return;const n=this._source.priceScale();if(null===n||n.isEmpty())return;if(!s.selection().isSelected(this._source)&&!this._source.isForcedDrawPriceAxisLabel())return;if(null===s.timeScale().visibleBarsStrictRange())return;const r=this._source.priceAxisPoints(),a=this._data.pointIndex;if(r.length<=a)return;const l=r[a];if(!isFinite(l.price))return;const d=this._source.ownerSource(),u=null!==d?d.firstValue():null
;if(null===u)return;let h=this._data.backgroundPropertyGetter?this._data.backgroundPropertyGetter():null;null===h&&(h=this._getBgColor()),i.background=(0,o.resetTransparency)(h),i.borderColor="#2E84A6",i.textColor=this.generateTextColor(i.background),i.coordinate=n.priceToCoordinate(l.price,u),t.text=this._formatPrice(l.price,u),t.visible=!0}_getBgColor(){return this._active?this._properties.childs().axisLineToolLabelBackgroundColorActive.value():this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}_formatPrice(t,e){return(0,s.ensureNotNull)(this._source.priceScale()).formatPrice(t,e)}}},515779:(t,e,i)=>{i.d(e,{LineDataSourceTimeAxisView:()=>n});var s=i(87521);class n extends s.TimeAxisView{constructor(t,e){super(t.model()),this._active=!1,this._source=t,this._pointIndex=e,this._properties=t.model().properties().childs().scalesProperties}setActive(t){this._active=t}_getBgColor(){return this._active?this._properties.childs().axisLineToolLabelBackgroundColorActive.value():this._properties.childs().axisLineToolLabelBackgroundColorCommon.value()}_getIndex(){if(!this._model.selection().isSelected(this._source))return null;const t=this._source.timeAxisPoints();return t.length<=this._pointIndex?null:t[this._pointIndex].index}_isVisible(){return!0}}},772062:(t,e,i)=>{i.d(e,{lineToolsLocalizedNames:()=>n});var s=i(444372);const n={LineTool5PointsPattern:s.t(null,void 0,i(942231)),LineToolABCD:s.t(null,void 0,i(246712)),LineToolArc:s.t(null,void 0,i(659324)),LineToolArrow:s.t(null,void 0,i(511858)),LineToolArrowMarkDown:s.t(null,void 0,i(673193)),LineToolArrowMarkLeft:s.t(null,void 0,i(401949)),LineToolArrowMarkRight:s.t(null,void 0,i(886275)),LineToolArrowMarkUp:s.t(null,void 0,i(162453)),LineToolBalloon:s.t(null,void 0,i(770540)),LineToolComment:s.t(null,void 0,i(309818)),LineToolBarsPattern:s.t(null,void 0,i(381994)),LineToolBezierCubic:s.t(null,void 0,i(77125)),LineToolBezierQuadro:s.t(null,void 0,i(678609)),LineToolBrush:s.t(null,void 0,i(243539)),LineToolCallout:s.t(null,void 0,i(925381)),LineToolCircleLines:s.t(null,void 0,i(584031)),LineToolCypherPattern:s.t(null,void 0,i(193191)),LineToolDateAndPriceRange:s.t(null,void 0,i(247017)),LineToolDateRange:s.t(null,void 0,i(485444)),LineToolDisjointAngle:s.t(null,void 0,i(91544)),LineToolElliottCorrection:s.t(null,void 0,i(980943)),LineToolElliottDoubleCombo:s.t(null,void 0,i(75112)),LineToolElliottImpulse:s.t(null,void 0,i(861114)),LineToolElliottTriangle:s.t(null,void 0,i(872359)),LineToolElliottTripleCombo:s.t(null,void 0,i(76129)),LineToolEllipse:s.t(null,void 0,i(978996)),LineToolExtended:s.t(null,void 0,i(452788)),LineToolFibChannel:s.t(null,void 0,i(659005)),LineToolFibCircles:s.t(null,void 0,i(182330)),LineToolFibRetracement:s.t(null,void 0,i(855986)),LineToolFibSpeedResistanceArcs:s.t(null,void 0,i(633880)),LineToolFibSpeedResistanceFan:s.t(null,void 0,i(202395)),LineToolFibSpiral:s.t(null,void 0,i(239014)),LineToolFibTimeZone:s.t(null,void 0,i(930622)),LineToolFibWedge:s.t(null,void 0,i(485042)),LineToolFlagMark:s.t(null,void 0,i(514600)),
LineToolImage:s.t(null,void 0,i(868065)),LineToolFlatBottom:s.t(null,void 0,i(745051)),LineToolAnchoredVWAP:s.t(null,void 0,i(584541)),LineToolGannComplex:s.t(null,void 0,i(844763)),LineToolGannFixed:s.t(null,void 0,i(960707)),LineToolGannFan:s.t(null,void 0,i(748683)),LineToolGannSquare:s.t(null,void 0,i(947460)),LineToolHeadAndShoulders:s.t(null,void 0,i(921928)),LineToolHorzLine:s.t(null,void 0,i(121795)),LineToolHorzRay:s.t(null,void 0,i(325487)),LineToolIcon:s.t(null,void 0,i(37913)),LineToolEmoji:s.t(null,void 0,i(273456)),LineToolSticker:s.t(null,void 0,i(443114)),LineToolInsidePitchfork:s.t(null,void 0,i(141686)),LineToolNote:s.t(null,void 0,i(986631)),LineToolTextNote:s.t(null,void 0,i(794389)),LineToolSignpost:s.t(null,void 0,i(467751)),LineToolParallelChannel:s.t(null,void 0,i(559256)),LineToolPitchfan:s.t(null,void 0,i(234156)),LineToolPitchfork:s.t(null,void 0,i(919634)),LineToolPolyline:s.t(null,void 0,i(401185)),LineToolPath:s.t(null,void 0,i(800371)),LineToolPrediction:s.t(null,void 0,i(920138)),LineToolPriceLabel:s.t(null,void 0,i(91282)),LineToolArrowMarker:s.t(null,void 0,i(936352)),LineToolPriceRange:s.t(null,void 0,i(768941)),LineToolProjection:s.t(null,void 0,i(375747)),LineToolRay:s.t(null,void 0,i(550318)),LineToolRectangle:s.t(null,void 0,i(426001)),LineToolCircle:s.t(null,void 0,i(191944)),LineToolRegressionTrend:s.t(null,void 0,i(802460)),LineToolRiskRewardLong:s.t(null,void 0,i(674832)),LineToolRiskRewardShort:s.t(null,void 0,i(508075)),LineToolFixedRangeVolumeProfile:s.t(null,{context:"study"},i(925705)),LineToolAnchoredVolumeProfile:s.t(null,{context:"study"},i(689633)),LineToolRotatedRectangle:s.t(null,void 0,i(56820)),LineToolSchiffPitchfork:s.t(null,void 0,i(657681)),LineToolSchiffPitchfork2:s.t(null,void 0,i(942608)),LineToolSineLine:s.t(null,void 0,i(839090)),LineToolText:s.t(null,{context:"tool"},i(691405)),LineToolTextAbsolute:s.t(null,void 0,i(642669)),LineToolThreeDrivers:s.t(null,void 0,i(46982)),LineToolTimeCycles:s.t(null,void 0,i(746852)),LineToolTrendAngle:s.t(null,void 0,i(35757)),LineToolTrendBasedFibExtension:s.t(null,void 0,i(680583)),LineToolTrendBasedFibTime:s.t(null,void 0,i(272159)),LineToolTrendLine:s.t(null,void 0,i(197339)),LineToolInfoLine:s.t(null,void 0,i(715992)),LineToolTriangle:s.t(null,void 0,i(901671)),LineToolTrianglePattern:s.t(null,void 0,i(390148)),LineToolVertLine:s.t(null,void 0,i(529535)),LineToolCrossLine:s.t(null,void 0,i(974334)),LineToolHighlighter:s.t(null,void 0,i(969476)),LineToolPriceNote:s.t(null,void 0,i(297512)),LineToolVbPFixed:s.t(null,void 0,i(840693)),LineToolGhostFeed:s.t(null,void 0,i(546808)),LineToolTable:s.t(null,void 0,i(17981))};n.LineToolTweet=s.t(null,void 0,i(636549)),n.LineToolIdea=s.t(null,void 0,i(215982)),n.LineToolNoteAbsolute=s.t(null,void 0,i(363209))},774440:(t,e,i)=>{i.d(e,{StudyLineDataSource:()=>T,isStudyLineTool:()=>m});var s=i(132565),n=i(7714),o=i(890390),r=i(807958),a=i(196302),l=i(479483),d=i(590178),u=i(808825),h=i(587482),c=i(37241),p=i(437642),_=i(454184),y=i(232915);class S extends y.StatusProviderBase{
constructor(t){super(),this._source=t}errorStatus(){const t=this._source.status();return t.type===_.StudyStatusType.Error?{error:this.sourceStatusText(),solutionId:(0,_.studyStatusSolutionId)(t),title:(0,_.studyStatusTitle)(t),studyFeature:(0,_.studyStatusFeature)(t)}:null}getSplitTitle(){return this._source.titleInParts()}getInputsTitles(){return null}text(){return this._source.translatedType()}sourceStatusText(){return(0,_.convertStudyStatusToString)(this._source.status(),!0)}}var g=i(239949),f=i(236578);class v extends f.StatusView{constructor(t){super(t.statusProvider({}))}getSplitTitle(){return this._statusProvider.getSplitTitle()}}function m(t){return t instanceof T}class T extends n.LineDataSource{constructor(t,e,s,n,o,r){super(t,n,o,r),this._indexes=null,this._inputs=null,this._definitionsViewModel=null,this._pointsetPoints=null,this._loadedPlots=null,this._loadedGraphics=null,this._beingCreatedPaneView=null,this._anchorsPaneView=null,this._isLegendDisplayed=!1,Promise.all([Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(74317),i.e(62622),i.e(3205),i.e(5262),i.e(51583)]).then(i.bind(i,473410)),Promise.all([i.e(20700),i.e(63317),i.e(4171),i.e(74317),i.e(62622),i.e(3205),i.e(5262),i.e(51583)]).then(i.bind(i,768260))]).then((e=>{const{LineToolBeingCreatedPaneView:i}=e[0],{StudyLineDataSourceAnchorsPaneView:s}=e[1];this._beingCreatedPaneView=new i(this,t),this._anchorsPaneView=new s(this,this.model()),this._model.lightUpdate()})),this._metaInfo=e,this._dataSource=new d.ExtendedStudyDataSource(t.chartApi(),t.mainSeries(),s,e),this._dataSource.dataCleared().subscribe(this,this._onDataCleared),this._dataSource.dataUpdated().subscribe(this,this._onDataUpdated),this._dataSource.studyStatusChanged().subscribe(this,this._onStudyStatusChanged),this._statusProvider=new S(this),this._statusView=new v(this),this._showStudyArgumentsProperty=t.properties().childs().paneProperties.childs().legendProperties.childs().showStudyArguments}isDisplayedInLegend(){return this._isLegendDisplayed}titleInParts(){const t=[];if(this._showStudyArgumentsProperty.value()&&this._inputs)for(const e of this._metaInfo.inputs){if(!0===e.isHidden||"bool"===e.type)continue;const i=this._inputs[e.id];t.push(i.toString())}return[this.name(),t]}destroy(){this._dataSource.dataUpdated().unsubscribeAll(this),this._dataSource.dataCleared().unsubscribeAll(this),this._dataSource.studyStatusChanged().unsubscribeAll(this),this._dataSource.destroy(),null!==this._definitionsViewModel&&(this._definitionsViewModel.destroy(),this._definitionsViewModel=null),this._unsubscribeApplyInputsOnSeriesCompleted(),this._isDestroyed=!0,super.destroy()}stop(){super.stop(),this._stopDataSource()}start(){super.start(),this._startDataSource()}metaInfo(){return this._metaInfo}graphicsInfo(){return this._metaInfo.graphics}series(){return this._model.mainSeries()}translatedType(){return this._metaInfo.description}name(){return this._metaInfo.description}studyId(){return this._metaInfo.id}setPoint(t,e,i){super.setPoint(t,this._preparePoint(e,i))}move(t){}clearData(){
this._pointsetPoints=null,this._clearAllDataExceptPointsetPoints(),this._onStudyInputsMayChange(),this.updateAllViews((0,p.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),super.clearData()}data(){return this.plots()}plots(){return this._loadedPlots||this._dataSource.plots()}graphics(){return this._loadedGraphics||this._dataSource.graphics()}valueAt(t,e){return this.ownerSource()?.symbolSource().valueAt(t,e)??null}firstValue(){return this._model.mainSeries().firstValue()}state(t){const e={...super.state(t),metaInfo:this.metaInfo().state()};return t&&(e.data=this.plots().state(),e.nonseriesindexes=this._indexes,e.graphics=(0,a.saveStudyGraphics)(this.graphics(),null)),e}restoreData(t){void 0!==t.data&&(this._loadedPlots=new s.PlotList((0,h.studyPlotFunctionMap)(this._metaInfo),h.studyEmptyPlotValuePredicate),this._loadedPlots.restoreState(t.data)),this._indexes=t.nonseriesindexes??this._indexes,this._loadedGraphics=t.graphics?(0,a.loadStudyGraphics)(t.graphics):this._loadedGraphics}getPropertyDefinitionsViewModel(){return null===this._definitionsViewModel?this._getPropertyDefinitionsViewModelClass().then((t=>null===t||this._isDestroyed?null:(null===this._definitionsViewModel&&(this._definitionsViewModel=new t(this._model.undoModel(),this)),this._definitionsViewModel))):Promise.resolve(this._definitionsViewModel)}paneViews(t){let e=[];if(this.isSourceHidden())return e;if(this._isReady()&&this._changeStatesStack.isEmpty()){const i=super.paneViews(t);null!==i&&(e=e.concat(i))}else null!==this._beingCreatedPaneView&&e.push(this._beingCreatedPaneView);return null!==this._anchorsPaneView&&e.push(this._anchorsPaneView),e}propertiesChanged(t){super.propertiesChanged(t),this._onStudyInputsMayChange()}dataAndViewsReady(){return super.dataAndViewsReady()&&this._isReady()}endChanging(t,e){const i=super.endChanging(t,e);return i.indexesChanged?this.clearData():this._updateAnchorsPrice(!0),i}moveData(t){this._dataSource.moveData(t)}restorePoints(t,e,i){super.restorePoints(t,e,i),this._updateAnchorsPrice(!0)}statusProvider(t){return this._statusProvider}statusView(){return this._statusView}legendView(){return null}dataProblemModel(){return null}dataUpdatedModeModel(){return null}marketStatusModel(){return null}onStatusChanged(){return this._dataSource.studyStatusChanged()}status(){return this._dataSource.studyStatus()}recalcStudyIfNeeded(){}static createPropertiesFromStudyMetaInfoAndState(t,e,i,s,n){const o=(0,c.prepareStudyPropertiesForLoadChart)(t,e,i,s,void 0,n);return this._configureProperties(o),o}_getPointsetPoints(){return this._pointsetPoints}_onStudyStatusChanged(t,e){let i;switch(e.type){case u.StudyStatusType.Error:i=!0;break;case u.StudyStatusType.Completed:i=!1;break;default:return}if(i===this._isLegendDisplayed)return;this._isLegendDisplayed=i;const s=this._model.paneForSource(this);if(s){const t=this._model.panes().indexOf(s),e=g.InvalidationMask.invalidateLegendWidgetLayout(t);this.model().invalidate(e)}}_studyId(){return this._dataSource.studyId()}_isReady(){return!0}_updateAllPaneViews(t){
super._updateAllPaneViews(t),this._beingCreatedPaneView?.update(),this._anchorsPaneView?.update(t)}_getPointTime(t,e){const i=t.index,s=this._model.timeScale().indexToTimePoint(i);return null!==s?s:e||void 0===t.time?null:this._utcTimeInCurrentResolution(t)}_updateAnchorsPrice(t){}_onPointsetUpdated(t){super._onPointsetUpdated(t),this._pointsetPoints=this._points.map((t=>({price:t.price,index:t.index,time:t.time}))),this._onStudyInputsMayChange()}_onDataCleared(){this.updateAllViews((0,p.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),this._model.updateSource(this)}_onDataUpdated(t,e,i){this._updateAnchorsPrice(),this.updateAllViews((0,p.sourceChangeEvent)({sourceId:this.id(),firstUpdatedTimePointIndex:t[0]?.index})),this._model.updateSource(this)}_onStudyInputsMayChange(){let t=null;const e=this._pointsetPoints;if(e?.length===this.pointsCount()){if(t=this._studyInputs(e),t){const e=this.metaInfo().inputs.map((t=>t.id));for(const i of Object.keys(t))e.includes(i)||delete t[i]}}else this._isDataSourceStarted()&&this._stopDataSource(!1);t?this._unsubscribeApplyInputsOnSeriesCompleted():this._subscribeApplyInputsOnSeriesCompleted(),this._areInputsEqual(this._inputs,t)||(this._applyStudyInputs(t),t?this._isDataSourceStarted()||this._startDataSource():(this._clearAllDataExceptPointsetPoints(),this.updateAllViews((0,p.sourceChangeEvent)(this.id()))))}_preparePoint(t,e){return super._preparePoint(this._alignPointToRangeOfActualData(t),e)}_getPropertyDefinitionsViewModelClass(){return Promise.resolve(null)}_subscribeApplyInputsOnSeriesCompleted(){this._unsubscribeApplyInputsOnSeriesCompleted(),this._model.mainSeries().dataEvents().completed().subscribe(this,(()=>this._onStudyInputsMayChange()),!0)}_unsubscribeApplyInputsOnSeriesCompleted(){this._model.mainSeries().dataEvents().completed().unsubscribeAll(this)}_onInputsChanged(){this.hasAlert().value()&&(this._localAndServerAlertsMismatch=!0)}_clearAllDataExceptPointsetPoints(){this._loadedPlots=null,this._indexes=null,this._loadedGraphics=null,this._dataSource.clearData()}_stopDataSource(t=!0){this._isDestroyed||(this._dataSource.stop(),t&&this.clearData())}_startDataSource(){this._isDestroyed||null===this._inputs||this._dataSource.start()}_isDataSourceStarted(){return this._dataSource.isStarted()}static _createPropertiesFromStudyIdAndState(t,e){const i=r.StudyMetaInfo.getStudyPropertyRootNameById(t),s=new o.DefaultProperty({defaultName:i,state:e});return this._configureProperties(s),s}static _configureProperties(t){super._configureProperties(t),t.removeExcludedKey("intervalsVisibilities",1),t.removeProperty("showLegendValues"),t.removeProperty("showLegendInputs")}_areInputsEqual(t,e){return null===e?null===t:null!==t&&(0,l.areStudyInputsEqual)(this._metaInfo.inputs,t,e)}_applyStudyInputs(t){this._inputs=t,null!==t&&this._dataSource.setInputs(t),this._onInputsChanged()}}},37241:(t,e,i)=>{i.d(e,{prepareStudyProperties:()=>P,prepareStudyPropertiesForLoadChart:()=>S})
;var s=i(998034),n=i(130551),o=i(735566),r=i(536794),a=i(807958),l=i(257145),d=i(85858),u=i(192809),h=i(266954),c=i(890390),p=i(744380),_=i(974145);const y=(0,o.getLogger)("Chart.Study");function S(t,e,i,n,o,l){return function(t,e,i,n,o,l,u){const h=function(t,e,i,n,o){t.version&&i.version&&t.version!==i.version&&y.logWarn("Serialized metaInfo version "+t.version+" is not equal to the saved state version "+i.version);const l=e||t,u=(0,r.clone)(l.defaults)??{},h=a.StudyMetaInfo.getStudyPropertyRootName(l),c=a.StudyMetaInfo.getStudyPropertyRootName(t);let p=f();(0,s.default)(p,g(t)),(0,s.default)(p,(0,r.clone)(t.defaults)),(0,s.default)(p,u),(0,s.default)(p,(0,d.factoryDefaults)(h)),(0,s.default)(p,(0,d.factoryDefaults)(c)),(0,s.default)(p,v(l,n,h)),(0,s.default)(p,v(t,n,c)),(0,s.default)(p,i),p=n.updateStudyState(p,t,e),void 0!==o&&e&&(p=o(i,p,t,e));a.StudyMetaInfo.versionOf(l)>=1&&(0,s.default)(p,m(u,p));return p}(t,e,i,n,l);return C(e||t,o,h,u,!0)}(t,e,i,n,a.StudyMetaInfo.getStudyPropertyRootName(t),o,l)}function g(t){const e={};if(t.plots)for(let i=0;i<t.plots.length;i++){const s=t.plots[i],n=s.id;if((0,_.isColorerPlot)(s))continue;const o={display:15,color:"#0496FF",linestyle:l.LINESTYLE_SOLID,linewidth:2,plottype:_.LineStudyPlotStyle.Line,trackPrice:!1};(0,_.isBarColorerPlot)(s)&&(o.transparency=0),o.plottype=s.type,o.title=n,e[n]=o}return{styles:e}}function f(){const t=(0,r.clone)((0,d.defaults)("study"));return t.intervalsVisibilities=(0,r.clone)(h.intervalsVisibilitiesDefaults),t}function v(t,e,i){let s=(0,r.clone)((0,d.defaults)(i,e));return"Overlay"!==t.shortId&&"Compare"!==t.shortId||(s.currencyId=null,s.unitId=null),t.isTVScript&&t.TVScriptSourceCode!==s.TVScriptSourceCode&&(s=(0,r.clone)((0,d.factoryDefaults)(i))),s}function m(t,e){const i={};return u.StudyVersioning.mergeInputsObjPart(i,t.inputs??{}),u.StudyVersioning.mergeInputsObjPart(i,e.inputs),{inputs:i}}function T(t,e,i,o){if(a.StudyMetaInfo.versionOf(t)<1)throw new Error("This function cannot work with metainfo of the old format version. Required format version >= 1");const l=a.StudyMetaInfo.getStudyPropertyRootName(t),u=(0,r.clone)(t.defaults),h=(0,d.factoryDefaults)(l),c=f();if((0,s.default)(c,g(t)),(0,s.default)(c,u),(0,s.default)(c,h),(0,s.default)(c,v(t,o,l)),(0,s.default)(c,e),(0,s.default)(c,m(u,c)),null!==i){const e=i.model().studiesColorRotatorFactory().getColorRotator(t);null!==e&&("Overlay@tv-basicstudies"===t.id?c.lineStyle.color=e.getColor(c.lineStyle.color,h.lineStyle.color===c.lineStyle.color):(0,s.default)(c,function(t,e){for(const i of Object.keys(t.styles)){const s=t.styles[i];if((0,n.isObject)(s)&&"color"in s){const t=s.color;s.color=e.getColor(t)}}return t}(c,e)))}return o.updateStudyInputsIfNeeded(c,c.version??t.version,t),c}function P(t,e,i,s,n){return function(t,e,i,s,n,o){const l=T(t,e,i,s),d=a.StudyMetaInfo.getSourceInputIds(t);return d.forEach(((t,e)=>{const i=l.inputs[t];e<o.length?l.inputs[t]=`${o[e].id()}$0`:(0,r.isString)(i)&&i.includes("$")&&(l.inputs[t]="close")})),C(t,n,l)
}(t,e,i,s,a.StudyMetaInfo.getStudyPropertyRootName(t),n)}const I=["id","description","description_localized","shortDescription","_metainfoVersion","is_price_study","is_hidden_study","priceScale","fullId","shortId","scriptIdPart","packageId","productId","isTVScriptStub","defaults","symbolSource","historyCalculationMayChange","format","linkedToSeries","isTVLibrary","docs","exports","exportTypes","extra","usesPrivateLib","financialPeriod","groupingKey","pine","isRGB","isTVScript","TVScriptMetaInfoExprs","usePlotsZOrder","isTVScriptStrategy","TVScriptSourceCode","lookaheadFutureData","hasAlertFunction","defaultStrategyAlertMessage","tags","canBeChild","canNotBeChild","_serverMetaInfoVersion","warnings"];function C(t,e,i,s,n){for(const t of I)delete i[t];const o=["visible","precision","minTick","intervalsVisibilities","inputs.first_visible_bar_time","inputs.last_visible_bar_time","inputs.subscribeRealtime","patchMetaInfoDefaults"];for(let e=0;e<t.inputs.length;++e){const i=t.inputs[e];i.isHidden&&(o.push(`inputs.${e}`),o.push(`inputs.${i.id}`))}const r=new c.DefaultProperty({defaultName:e,state:i,excludedDefaultsKeys:o,excludedStateKeys:["version"],theme:s});r.removeProperty("intervalsVisibilities"),r.addChild("intervalsVisibilities",new p.IntervalsVisibilitiesProperty(i&&i.intervalsVisibilities)),"PivotPointsStandard@tv-basicstudies"!==t.id&&"PivotPointsHighLow@tv-basicstudies"!==t.id||!r.hasChild("font")||r.removeProperty("font");const l=a.StudyMetaInfo.versionOf(t);return r.hasChild("version")?r.childs().version?.setValue(l):r.addProperty("version",l),t.TVScriptMetaInfoExprs&&!n&&r.addProperty("patchMetaInfoDefaults",!0),r}},590178:(t,e,i)=>{i.d(e,{ExtendedStudyDataSource:()=>o});var s=i(901466),n=i(454184);class o extends s.StudyDataSource{constructor(t,e,i,s){super(t,e.seriesSource(),i,s),this._series=e}_createStudyError(t){return(0,n.createStudyError)(this._getStudyErrorDescription(t),this._series.symbolInfo()?.exchange)}}},901466:(t,e,i)=>{i.r(e),i.d(e,{StudyDataSource:()=>_});var s=i(650151),n=i(547465),o=i(132565),r=i(359035),a=i(807958),l=i(259710),d=i(587482),u=i(284881),h=i(808825);const c=(0,i(735566).getLogger)("Chart.StudyDataSource");var p;!function(t){t[t.Idle=0]="Idle",t[t.AwaitingConnection=1]="AwaitingConnection",t[t.AwaitingParent=2]="AwaitingParent",t[t.AwaitingFirstDataUpdate=3]="AwaitingFirstDataUpdate",t[t.Active=4]="Active"}(p||(p={}));class _{constructor(t,e,i,s,r=!1){this._inputs=null,this._status=p.Idle,this._studyId=null,this._turnaroundCounter=1,this._studyStatus={type:h.StudyStatusType.Undefined},this._studyStatusChanged=new n.Delegate,this._dataCleared=new n.Delegate,this._dataUpdated=new n.Delegate,this._boundOnGatewayIsConnectedChanged=this._onGatewayIsConnectedChanged.bind(this),this._ongoingDataUpdate=Promise.resolve(),this._gateway=t,this._metaInfo=s,this._forceUseExclamationMark=r,this._seriesSource=e,this._turnaroundPrefix=i,this._plots=new o.PlotList((0,d.studyPlotFunctionMap)(s),d.studyEmptyPlotValuePredicate),
this._gateway.isConnected().subscribe(this._boundOnGatewayIsConnectedChanged),this._graphics=new u.LiveStudyGraphics(s.graphics)}destroy(){this.stop(),this._gateway.isConnected().unsubscribe(this._boundOnGatewayIsConnectedChanged),this._seriesSource.dataEvents().created().unsubscribeAll(this)}metaInfo(){return this._metaInfo}inputs(){return this._inputs}setInputs(t){this._inputs=t,null!==this._studyId&&(this._turnaroundCounter++,this._onStudyStatusChangedTo({type:h.StudyStatusType.Undefined}),this._gateway.modifyStudy(this._studyId,this._turnaround(),t,this._onMessage.bind(this)),this._status===p.Active&&this._changeStatusTo(p.AwaitingFirstDataUpdate))}isStarted(){return this._status!==p.Idle}isActive(){return this._status===p.Active}start(){this.isStarted()?c.logNormal("start: data source is already started, nothing to do"):((0,s.assert)(null!==this._inputs,"Inputs should be defined when starting a study data source"),this._gateway.isConnected().value()?this._createStudy():this._changeStatusTo(p.AwaitingConnection))}stop(){this.isStarted()?(null!==this._studyId&&(this._gateway.isConnected().value()&&this._gateway.removeStudy(this._studyId),this._studyId=null,this._onStudyStatusChangedTo({type:h.StudyStatusType.Undefined})),this._changeStatusTo(p.Idle)):c.logNormal("stop: data source is already stopped, nothing to do")}studyId(){return this._studyId}studyStatus(){return this._studyStatus}studyStatusChanged(){return this._studyStatusChanged}plots(){return this._plots}graphics(){return this._graphics}clearData(){this._plots.clear(),this._graphics.clear(),this._dataCleared.fire()}stopAndStealData(){(0,s.assert)(this._status===p.Active,"Couldn't steal data from non-active data source"),this.stop();const t=this._plots,e=this._graphics.extract();return this._plots=new o.PlotList((0,d.studyPlotFunctionMap)(this._metaInfo),d.studyEmptyPlotValuePredicate),{plots:t,graphics:e}}dataCleared(){return this._dataCleared}dataUpdated(){return this._dataUpdated}moveData(t){this._ongoingDataUpdate=this._ongoingDataUpdate.then((()=>{this._plots.move(t)}))}pendingUpdatesReady(){return this._ongoingDataUpdate}_createStudyError(t){return{type:h.StudyStatusType.Error,errorDescription:this._getStudyErrorDescription(t)}}_getStudyErrorDescription(t){return"string"==typeof t?{error:t.split(":",2)[0]}:t}_changeStatusTo(t){(0,s.assert)(this._status!==t,"Source and destination status should be distinct"),c.logNormal(`Status changed from ${p[this._status]} to ${p[t]}`),this._status=t}_createStudy(){const t=this._seriesSource.instanceId();null!==t?this._createStudyUsingParentId(t):(this._changeStatusTo(p.AwaitingParent),this._seriesSource.dataEvents().created().subscribe(this,this._onSeriesCreated,!0))}_createStudyUsingParentId(t){(0,s.assert)(this._status!==p.Active,'Status should not be "Active" when creating a study'),(0,s.assert)(this._studyStatus.type===h.StudyStatusType.Undefined,'Study status should be "Undefined" when creating a study'),(0,s.assert)(null===this._studyId,"Study id should be empty when creating a study"),this._studyId=(0,
l.makeNextStudyId)(),this._gateway.createStudy(this._studyId,this._turnaround(),t,a.StudyMetaInfo.getStudyIdWithLatestVersion(this.metaInfo(),this._forceUseExclamationMark),(0,s.ensureNotNull)(this._inputs),this._onMessage.bind(this),{id:this._metaInfo.id}),this._changeStatusTo(p.AwaitingFirstDataUpdate)}_onGatewayIsConnectedChanged(t){t?this._onGatewayConnected():this._onGatewayDisconnected()}_onGatewayConnected(){this._status===p.AwaitingConnection&&this._createStudy()}_onGatewayDisconnected(){this._status!==p.Idle&&this._status!==p.AwaitingConnection&&(this._studyId=null,this._changeStatusTo(p.AwaitingConnection),this._studyStatus.type!==h.StudyStatusType.Undefined&&this._onStudyStatusChangedTo({type:h.StudyStatusType.Undefined})),this._turnaroundCounter=1}_onSeriesCreated(){this._status===p.AwaitingParent&&this._createStudyUsingParentId((0,s.ensure)(this._seriesSource.instanceId()))}_onStudyStatusChangedTo(t){const e=this._studyStatus;this._studyStatus=t,c.logNormal(`Study status type changed from ${h.StudyStatusType[e.type]} to ${h.StudyStatusType[t.type]}`),this._studyStatusChanged.fire(e,t)}_onMessage(t){if("data_update"===t.method){const{customId:e,turnaround:i,plots:n,nonseries:o}=t.params;e===this._studyId&&this._checkTurnaround(i)&&this._onDataUpdate(n,(0,s.ensureDefined)(o))}else if("study_loading"===t.method){const[e,i]=t.params;e===this._studyId&&this._checkTurnaround(i)&&this._onStudyLoading(t.time)}else if("study_completed"===t.method){const[e,i]=t.params;e===this._studyId&&this._checkTurnaround(i)&&this._onStudyCompleted(t.time)}else if("study_error"===t.method){const[e,i,s,n]=t.params;e===this._studyId&&this._checkTurnaround(i)&&this._onStudyError(s,n,t.time)}else"clear_data"===t.method&&this._checkTurnaround(t.params.turnaround)&&this.clearData()}_onDataUpdate(t,e){const i=(0,r.unpackNonSeriesData)(e.d);return this._ongoingDataUpdate=this._ongoingDataUpdate.then((()=>i),(()=>i)).then(this._onDataUnpacked.bind(this,t,e.indexes)),this._ongoingDataUpdate}_onDataUnpacked(t,e,i){this._status!==p.Idle&&(this._status===p.AwaitingFirstDataUpdate&&(this._changeStatusTo(p.Active),this.clearData()),this._mergePlots(t),null!==i&&(i.indexes_replace?((0,s.assert)("nochange"!==e),this._graphics.replaceIndexesTo(e)):("nochange"!==e&&this._graphics.replaceIndexesTo(e),void 0!==i.graphicsCmds&&this._graphics.processCommands(i.graphicsCmds))),this._dataUpdated.fire(t,i,e))}_onStudyLoading(t){this._onStudyStatusChangedTo({type:h.StudyStatusType.Loading,startTime:Date.now()})}_onStudyError(t,e,i){this.clearData(),this._onStudyStatusChangedTo(this._createStudyError(t))}_onStudyCompleted(t){this._onStudyStatusChangedTo({type:h.StudyStatusType.Completed})}_mergePlots(t){this._plots.merge(t)}_turnaround(){return`${this._turnaroundPrefix}${this._turnaroundCounter}`}_checkTurnaround(t){const e=this._turnaround();return t===e||t===this._seriesSource.turnaround()||t===`${this._seriesSource.turnaround()}_${e}`}}},616427:(t,e,i)=>{i.d(e,{areEqualSymbols:()=>r,compareSymbolParams:()=>u,symbolParams:()=>d,symbolSameAsCurrent:()=>l
});i(931924);var s=i(388741),n=i(477786);const o=!0;function r(t,e){return void 0===t?void 0===e:void 0!==e&&(o?t.toUpperCase()===e.toUpperCase():t===e)}function a(t,e){return t.some((t=>r(e,t)))}function l(t,e){if(null===e)return!1;if(e){if(r(e.full_name,t)||r(e.pro_name,t))return!0;if(r(e.ticker,t))return!0;if(e.aliases&&a(e.aliases,t))return!0;if(e.alternatives&&a(e.alternatives,t))return!0;if(0===t.indexOf("FRA:")&&r(e.pro_name,t.replace("FRA:","FWB:")))return!0}return!1}function d(t){return{symbol:t.symbol(),currency:t.currency(),unit:t.unit(),interval:t.interval(),style:t.style()}}function u(t,e,i){const{symbol:o,currency:r,unit:a,style:l,interval:d}=e,u=void 0!==o&&!t.symbolSameAsResolved(o);let h,c;const p=t.symbolInfo();null!==p?(h=void 0!==r&&!function(t,e){return null===t&&!(0,s.isConvertedToOtherCurrency)(e)||t===(0,s.symbolCurrency)(e)}(r,p),c=void 0!==a&&!function(t,e,i){return null===t&&!(0,s.isConvertedToOtherUnit)(e,i)||t===(0,s.symbolUnit)(e,i)}(a,p,i)):(h=void 0!==r&&r!==t.currency(),c=void 0!==a&&a!==t.unit());return{symbolChanged:u,intervalChanged:void 0!==d&&!n.Interval.isEqual(t.interval(),d),currencyChanged:h,unitChanged:c,styleChanged:void 0!==l&&l!==t.style(),styleChangeRequiresRestart:void 0!==l&&(0,s.styleChangeRequiresRestart)(l,t.style())}}},87521:(t,e,i)=>{i.d(e,{TimeAxisView:()=>r});var s=i(534328),n=i(688857);class o{constructor(){this._data=null}setData(t){this._data=t}draw(t,e,i){if(null===this._data||!this._data.visible||0===this._data.text.length)return;const s=this._data;t.font=i.font;const o=Math.round(i.widthCache.measureText(t,s.text));if(o<=0)return;t.save();const r=i.paddingHorizontal,a=o+2*r,l=a/2;let d=s.coordinate,u=Math.floor(d-l)+.5;if(s.alwaysInViewPort){const t=s.width;u<0?(d+=Math.abs(0-u),u=Math.floor(d-l)+.5):u+a>t&&(d-=Math.abs(t-(u+a)),u=Math.floor(d-l)+.5)}const h=u+a,c=Math.ceil(0+i.borderSize+i.offsetSize+i.paddingTop+i.fontSize+i.paddingBottom),{horizontalPixelRatio:p,verticalPixelRatio:_}=e;t.fillStyle=s.background;const y=Math.round(u*p),S=Math.round(0*_),g=Math.round(h*p),f=Math.round(c*_),v=Math.round(2*p);t.beginPath(),t.moveTo(y,S),t.lineTo(y,f-v),t.arcTo(y,f,y+v,f,v),t.lineTo(g-v,f),t.arcTo(g,f,g,f-v,v),t.lineTo(g,S),t.fill();const m=0+i.borderSize+i.offsetSize+i.paddingTop+i.fontSize/2;t.textAlign="left",t.textBaseline="middle",t.fillStyle=s.color;const T=i.widthCache.yMidCorrection(t,"Apr0");t.translate((u+r)*p,(m+T)*_),(0,n.drawScaled)(t,p,_,(()=>t.fillText(s.text,0,0))),t.restore()}}class r{constructor(t){this._renderer=new o,this._rendererData={background:"",color:"",coordinate:0,text:"",visible:!1,width:0,alwaysInViewPort:!0},this._invalidated=!0,this._model=t,this._renderer.setData(this._rendererData)}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}coordinate(){return this._rendererData.coordinate}_getAlwaysInViewPort(){return!0}_getText(t){const e=this._model.timeScale().indexToUserTime(t);return null!==e?this._model.dateTimeFormatter().format(e):""}_updateImpl(){
const t=this._rendererData;if(t.visible=!1,this._model.timeScale().isEmpty()||!this._isVisible())return;const e=this._getIndex();null!==e&&Number.isFinite(e)&&(t.visible=!0,t.width=this._model.timeScale().width(),t.background=this._getBgColor(),t.color=(0,s.colorFromBackground)(t.background),t.coordinate=this._model.timeScale().indexToCoordinate(e),t.alwaysInViewPort=this._getAlwaysInViewPort(),t.text=this._getText(e),this._invalidated=!1)}}},422063:(t,e,i)=>{i.d(e,{UndoCommand:()=>n});var s=i(418450);class n{constructor(t,e=!0,i=!0){this._text=t||new s.TranslatedString("",""),this._executeOnPush=e,this._affectsState=i}text(){return this._text}executeOnPush(){return this._executeOnPush}affectsState(){return this._affectsState}canMerge(t){return!1}merge(t){throw new Error("Should be re-implemented in child classes")}}},75060:(t,e,i)=>{i.d(e,{canPlaceAlertOnResolution:()=>o});var s=i(477786),n=i(778016);function o(t,e){const i=s.Interval.isSeconds(t),o=e?e?.alertsOnSeconds:(0,n.enabled)("ALERTS_ON_SECONDS");return!i||o}},972155:(t,e,i)=>{i.d(e,{getChartAlertsFacade:()=>a,getChartAlertsFacadeIfCreatedBefore:()=>l});const s=(0,i(481251).default)((async()=>{const{AlertsFiresFocusHandler:t}=await i.e(69581).then(i.bind(i,469517));return new t}));var n=i(154890);let o,r;async function a(){return o||(o=async function(){const[t,{getAlertsCollection:e},o,r]=await Promise.all([Promise.all([i.e(32856),i.e(54945),i.e(90345),i.e(26312),i.e(80349),i.e(72738),i.e(27568),i.e(67653),i.e(12557),i.e(36679)]).then(i.bind(i,886290)),Promise.all([i.e(83477),i.e(35706),i.e(90345),i.e(26312),i.e(80349),i.e(72738),i.e(27568),i.e(14141)]).then(i.bind(i,827568)),(0,n.getChartSourceIdsGetter)(),s()]);return new t.ChartAlertsFacade(e(),r,o)}()),r||(r=await o),r}function l(){return r??null}},154890:(t,e,i)=>{i.d(e,{getChartSourceIdsGetter:()=>s});const s=(0,i(481251).default)((async()=>{const{ChartSourceIdsGetter:t}=await Promise.all([i.e(92027),i.e(90345),i.e(26312),i.e(80349),i.e(72738),i.e(27568),i.e(79979)]).then(i.bind(i,517696));return new t}))},234938:(t,e,i)=>{i.d(e,{showGoProAlertsOnSecondsDialog:()=>n});var s=i(707934);i(659863);function n(){(0,s.createGoProDialog)({feature:"alertsOnSeconds"})}}}]);