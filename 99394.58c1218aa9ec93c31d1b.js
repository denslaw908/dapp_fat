(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[99394],{223124:(e,t,i)=>{"use strict";i.d(t,{isCancelled:()=>s,makeCancelable:()=>n});class r extends Error{constructor(){super("CancelToken")}}function n(e){let t=!1;return{promise:new Promise(((i,n)=>{e.then((e=>t?n(new r):i(e))),e.catch((e=>n(t?new r:e)))})),cancel(){t=!0}}}function s(e){return e instanceof r}},542682:(e,t,i)=>{"use strict";i.d(t,{isTouchEvent:()=>n});var r=i(778785);function n(e){const t=e.sourceCapabilities;let i=t&&t.firesTouchEvents;return void 0===i&&(i=r.touch),i}},104436:(e,t,i)=>{"use strict";var r;i.d(t,{ToolboxType:()=>r}),function(e){e[e.Delete=0]="Delete"}(r||(r={}))},255681:(e,t,i)=>{"use strict";function r(e){return"economic"===e}i.d(t,{isNonTradableSymbolType:()=>r})},454623:(e,t,i)=>{"use strict";i.d(t,{defaultChartWidgetActionsOptions:()=>r});const r={general:!0,mainSeries:!0,mainSeriesTrade:!1,esdStudies:!0,studies:!0,fundamentals:!0,lineTools:!0,publishedCharts:!0,ordersAndPositions:!0,alerts:!0,chartEvents:!0,objectTree:!0,gotoLineTool:!1}},322652:(e,t,i)=>{"use strict";i.d(t,{clipboardDataForSources:()=>l,isLineToolClipboardData:()=>a});var r=i(650151),n=i(816433),s=i(128090),o=i(545372);function a(e){return"drawing"===e.type}function l(e,t){if(1===t.length&&(0,s.isStudy)(t[0])){const e=t[0];return{title:e.title(n.TitleDisplayTarget.StatusLine),sources:[{source:(0,r.ensureNotNull)(e.state()),type:"study"}]}}const i={sources:[],title:""};return i.sources=t.filter((e=>e.copiable()&&(0,o.isLineTool)(e))).map((t=>{const i={type:"drawing",geometry:t.geometry(),source:{...t.state(!1),points:t.normalizedPoints()},modelId:e};return delete i.source.alertId,i})),i.sources.length>0?(1===i.sources.length?i.title=t[0].title(n.TitleDisplayTarget.StatusLine):i.title="Drawings",i):null}},395081:(e,t,i)=>{"use strict";var r;i.d(t,{TabNames:()=>r}),function(e){e.background="Background",e.coordinates="Coordinates",e.drawings="Drawings",e.events="Events",e.alerts="Alerts",e.inputs="Inputs",e.properties="Properties",e.scales="Scales",e.legend="Legend",e.sourceCode="Source Code",e.style="Style",e.symbol="Symbol",e.timezoneSessions="Timezone/Sessions",e.trading="Trading",e.visibility="Visibility",e.text="Text"}(r||(r={}))},148828:(e,t,i)=>{"use strict";i.d(t,{getPriceAxisNameInfo:()=>o});const r=["Z","Y","X","W","V","U","T","S"],n=["A","B","C","D","E","F","G","H"];class s{constructor(e){this.label=e}equals(e){return null!==e&&this.label===e.label}}function o(e,t){const i="left"===e?r:n,o=t<i.length?i[t]:"";return new s(o)}},723809:(e,t,i)=>{"use strict";i.d(t,{showScriptInfoErrorNoticeDialog:()=>s});var r=i(444372),n=i(779923);function s(){(0,n.showWarning)({title:r.t(null,void 0,i(163200)),text:r.t(null,void 0,i(586698)),buttonText:r.t(null,void 0,i(515462)),backdrop:!0})}},184481:(e,t,i)=>{"use strict";i.d(t,{createTradeContext:()=>n});var r=i(650151);async function n({series:e,isMainChart:t,y:i}){let n=NaN,s=NaN,o="";const a=e.proSymbol(),l=(e.symbolInfo()||{name:null}).name||a,c=e.priceScale();if(i){const t=e.firstValue()
;n=null!==t?c.coordinateToPrice(i,t):null,o=null!==n?e.formatter().format(n):""}const d=e.bars().last();null!==d&&(s=(0,r.ensure)(d.value[4]));return{symbol:a,displaySymbol:l,value:n,formattedValue:o,last:s,symbolInfoTradable:!!(e.symbolInfo()||{is_tradable:!1}).is_tradable,isMainChart:t}}},699576:(e,t,i)=>{"use strict";i.d(t,{tradingService:()=>s,waitTradingService:()=>o});var r=i(564894);const n={id:"TradingService"};function s(){return(0,r.hasService)(n)?(0,r.service)(n):null}function o(){return(0,r.waitServiceRegistered)(n)}},747324:(e,t,i)=>{"use strict";i.d(t,{ALERT_LABEL_WIDTH:()=>ge,AlertLabel:()=>xe,isAlertLabel:()=>be});var r=i(650151),n=i(790188),s=i(327052),o=i(239949),a=i(644036),l=i(839800),c=i(905520),d=i(542301),h=i(477786),u=i(388741),_=i(437642),p=i(820028),m=i(347505),g=i(345848),b=i(998193),v=i(86441),f=i(444372),x=i(708162),w=i(731974),y=i(23076),C=i(765935),S=i(5481),P=i(311848),T=i(130595);const A=e=>{if(1!==e.length)return{title:f.t(null,void 0,i(423481)),text:f.t(null,void 0,i(955138)),mainButtonText:f.t(null,void 0,i(14180)),isDangerAction:!0};const t=e[0],r=(0,P.getAlertDescription)(t);return{title:f.t(null,void 0,i(2376)),text:f.t(null,void 0,i(332063)).format({alert:(0,T.cutString)(r,100)}),mainButtonText:f.t(null,void 0,i(14180)),isDangerAction:!0}};var M,R=i(257145),I=i(338242),B=i(320994),D=i(65840);!function(e){e[e.ConnectorOffsetFromPriceScale=37]="ConnectorOffsetFromPriceScale",e[e.ConnectorCircleRadius=4]="ConnectorCircleRadius"}(M||(M={}));class k extends B.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e,t){const i=(0,D.interactionTolerance)().line;for(let r=0;r<this._data.levels.length;r++){const n=this._data.levels[r],[s,o]=this._calculateLeftRight(this._data,n,t.mediaSize.width,1),a=Math.min(s,o),l=Math.max(s,o);if(Math.abs(n.y-e.y)<=i&&e.x>=a&&e.x<=l)return new w.HitTestResult(w.HitTarget.MovePoint,{activeItem:r,hideCrosshairLinesOnHover:!0,areaName:w.AreaName.Line,cursorType:C.PaneCursorType.VerticalResize})}const r=this._data.levels.map((e=>e.y)),n=Math.min(...r),s=Math.max(...r),o=Math.round(this._data.isLeft?M.ConnectorOffsetFromPriceScale:t.mediaSize.width-M.ConnectorOffsetFromPriceScale);if(Math.abs(o-e.x)<i&&e.y>=n&&e.y<=s){const t=r.reduce(((t,i,r)=>{const n=Math.abs(t.level-e.y);return Math.abs(i-e.y)<n?{index:r,level:i}:t}),{index:0,level:r[0]});return new w.HitTestResult(w.HitTarget.MovePoint,{activeItem:t.index,hideCrosshairLinesOnHover:!0,areaName:w.AreaName.Line,cursorType:C.PaneCursorType.VerticalResize})}return null}_drawImpl(e){const t=e.context;if(t.lineWidth=Math.max(1,Math.floor(e.verticalPixelRatio)),t.strokeStyle=this._data.color,(0,I.setLineStyle)(t,R.LINESTYLE_DASHED),this._data.levels.forEach((i=>{const r=Math.round(i.y*e.verticalPixelRatio),[n,s]=this._calculateLeftRight(this._data,i,e.bitmapSize.width,e.horizontalPixelRatio);(0,I.drawHorizontalLine)(t,r,n,s)})),this._data.withConnector&&this._data.levels.length>1){
const i=Math.round(this._data.isLeft?M.ConnectorOffsetFromPriceScale*e.horizontalPixelRatio:e.bitmapSize.width-M.ConnectorOffsetFromPriceScale*e.horizontalPixelRatio)+.5,r=this._data.levels.map((e=>e.y)),n=Math.min(...r),s=Math.max(...r);t.beginPath(),t.moveTo(i,n*e.verticalPixelRatio),t.lineTo(i,s*e.verticalPixelRatio),t.stroke()}}_calculateLeftRight(e,t,i,r){const n=1===e.levels.length?0:Math.floor(M.ConnectorCircleRadius*r);let s,o;return this._data.isLeft?(o=0,s="full"===t.mode?i:Math.round("toConnector"===t.mode?(M.ConnectorOffsetFromPriceScale-n)*r:this._data.distanceToTooltip*r)):(s="full"===t.mode?0:Math.round("toConnector"===t.mode?i-(M.ConnectorOffsetFromPriceScale-n)*r:i-this._data.distanceToTooltip*r),o=i),[s,o]}}var L=i(934026),N=i(688857),V=i(964401),E=i(910282),H=i(837462),O=i(960433),z=i(660439),F=i(16241);var W=i(30556),U=i(674488);const Y=(0,H.makeFont)(12,E.CHART_FONT_FAMILY),q=" â€¢ ",j=(0,V.svgRenderer)(W),Z=(0,V.svgRenderer)(U);class $ extends B.BitmapCoordinatesPaneRenderer{constructor(){super(),this._data=null,this._lastPaintTextWidth=null,this._lastPaintPaneWidth=null,this._widthCache=new O.TextWidthCache}setData(e){this._data=e}hitTest(e){const t=this._data;if(null===this._lastPaintTextWidth||!t||null===this._lastPaintPaneWidth)return null;const i=this._lastPaintTextWidth+16+26,r=this._calculatePoint(t,i,this._lastPaintPaneWidth);{const n=new v.Point(r.x-26+i,r.y-9.5),s=n.add(new v.Point(26,19));if((0,L.pointInBox)(e,(0,v.box)(n,s)))return new w.HitTestResult(w.HitTarget.Custom,{activeItem:t.lineIndex,hideCrosshairLinesOnHover:!0,areaName:w.AreaName.Button,cursorType:C.PaneCursorType.Default,clickHandler:t.buttonAction,tapHandler:t.buttonAction})}{const n=new v.Point(r.x,r.y-9.5),s=n.add(new v.Point(i,19));if((0,L.pointInBox)(e,(0,v.box)(n,s)))return new w.HitTestResult(w.HitTarget.MovePoint,{activeItem:t.lineIndex,hideCrosshairLinesOnHover:!0,areaName:w.AreaName.Tooltip,cursorType:C.PaneCursorType.VerticalResize})}return null}_drawImpl(e){const t=this._data;if(!t)return;const i=e.context;this._lastPaintPaneWidth=e.mediaSize.width,i.font=Y;const n=t.text,s=t.additionalText;let o=!1,a=null;s&&(this._lastPaintTextWidth=this._widthCache.measureText(i,n+q+s),a=this._tooltipSizes(e),o=a.contentWidth<=a.maxWidth);let l=n;if(!o&&(this._lastPaintTextWidth=this._widthCache.measureText(i,l),a=this._tooltipSizes(e),a.contentWidth>a.maxWidth)){l=function(e,t,i){const r=(0,z.lowerboundExt)((t=>e.substring(0,t)),t,((t,r)=>i(t===e?e:(0,F.appendEllipsis)(t))<r),0,e.length);return r===e.length?e:(0,F.appendEllipsis)(e.substring(0,r))}(l,a.maxWidth-16-26,(e=>this._widthCache.measureText(i,e)))}const c=(0,r.ensureNotNull)(a).maxWidth,d=Math.round(c*e.horizontalPixelRatio),h=Math.round(19*e.verticalPixelRatio),u=this._calculatePoint(t,c,this._lastPaintPaneWidth);this._drawBorderAround(t,e,u,d,h,(e=>e.fill())),this._drawButton(t,e,u,d,h),this._drawText(t,e,u,l),o&&this._drawAdditionalText(t,e,u),this._drawBorderAround(t,e,u,d,h,(e=>e.stroke()))}_drawButton(e,t,i,r,n){const s=t.context
;i=i.add(new v.Point(r/t.horizontalPixelRatio,0));{const r=Math.round((i.x-26)*t.horizontalPixelRatio)+.5,o=Math.round(i.y*t.verticalPixelRatio-.5*n)+.5;s.fillStyle=e.buttonBackColor,s.fillRect(r,o,26*t.horizontalPixelRatio,n),s.strokeStyle=e.buttonBorderColor,s.lineWidth=Math.max(1,Math.floor(t.verticalPixelRatio)),s.beginPath(),s.moveTo(r,o),s.lineTo(r,o+n),s.stroke()}0===e.buttonType?this._drawIcon(t,i,j,e.lineColor):1===e.buttonType&&this._drawIcon(t,i,Z,e.restartIconColor)}_drawIcon(e,t,i,n){const s=e.context,{width:o,height:a}=i.viewBox();s.fillStyle=(0,r.ensureDefined)(n),i.render(s,{targetViewBox:{x:Math.round((t.x-4-o)*e.horizontalPixelRatio),y:Math.round((t.y-a/2)*e.verticalPixelRatio),width:Math.round(o*e.horizontalPixelRatio),height:Math.round(a*e.verticalPixelRatio)},doNotApplyColors:!0})}_tooltipSizes(e){const t=(0,r.ensureNotNull)(this._lastPaintTextWidth)+16+26,i=Math.max(20,.9*(e.mediaSize.width-80));return{contentWidth:t,maxWidth:Math.min(t,i)}}_drawText(e,t,i,r){const n=t.context,s=Math.round((i.x+8)*t.horizontalPixelRatio),o=Math.round((i.y+5)*t.verticalPixelRatio);n.save(),n.translate(s,o),(0,N.drawScaled)(n,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{n.fillStyle=e.textColor,n.fillText(r,0,0)})),n.restore()}_drawAdditionalText(e,t,i){const n=t.context,s=Math.round(this._widthCache.measureText(n,e.text)*t.horizontalPixelRatio),o=Math.round(this._widthCache.measureText(n,q)*t.horizontalPixelRatio),a=Math.round((i.x+8)*t.horizontalPixelRatio)+s,l=Math.round((i.y+5)*t.verticalPixelRatio);n.save(),n.fillStyle=(0,r.ensureDefined)(e.additionalTextColor),n.translate(a,l),(0,N.drawScaled)(n,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{n.fillStyle=(0,r.ensureDefined)(e.textColor),n.fillText(q,0,0)})),n.translate(o,0),(0,N.drawScaled)(n,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{n.fillStyle=(0,r.ensureDefined)(e.additionalTextColor),n.fillText((0,r.ensureDefined)(e.additionalText),0,0)})),n.restore()}_drawBorderAround(e,t,i,r,n,s){const o=t.context,a=Math.round(i.x*t.horizontalPixelRatio)+.5,l=Math.round(i.y*t.verticalPixelRatio-n/2)+.5;o.strokeStyle=e.lineColor,o.lineWidth=Math.max(1,Math.floor(t.verticalPixelRatio));const c=Math.round(4*t.horizontalPixelRatio);o.fillStyle=e.backColor,o.beginPath(),(0,I.drawRoundRect)(o,a,l,r,n,c),s(o)}_calculatePoint(e,t,i){const r=e.point;if(e.center){const n=Math.max(0,.5*(i-t));return e.isLeft?n<r.x?r:new v.Point(n,r.y):n+t<r.x?new v.Point(n,r.y):new v.Point(r.x-t,r.y)}return e.isLeft?r:r.subtract(new v.Point(t,0))}}var G;!function(e){e[e.SelectionPointOffset=37]="SelectionPointOffset",e[e.NoLineModeOffsetSingleLine=47]="NoLineModeOffsetSingleLine",e[e.NoLineModeOffsetMultipleLines=62]="NoLineModeOffsetMultipleLines"}(G||(G={}));const X=" â€” ",J=f.t(null,{context:"alert_status"},i(730829)),K=J+X+f.t(null,{context:"alert_status"},i(261129)),Q=J+X+f.t(null,{context:"alert_status"},i(401732)),ee=J+X+f.t(null,{context:"alert_status"},i(660963)),te=new Map([[s.AlertStopReason.Auto,Q],[s.AlertStopReason.Manual,K],[s.AlertStopReason.Expired,ee]])
;function ie(e){return void 0!==e?te.get(e):void 0}function re(e,t){switch(e){case s.AlertStopReason.Auto:return t.inActiveTextTriggeredColor;case s.AlertStopReason.Manual:return t.inActiveTextManualColor;case s.AlertStopReason.Expired:return t.inActiveTextExpiredColor;default:return}}class ne{constructor(e,t){this._invalidated=!0,this._compositeRenderer=new x.CompositeRenderer,this._tooltipRenderer=new $,this._alertLabel=e,this._model=t}update(){this._invalidated=!0}invalidate(){this._model.lightUpdate()}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._compositeRenderer}_updateImpl(){this._compositeRenderer.clear();const e=this._alertLabel,t=e.alert(),i=t.condition();if(null===i)return;const n=(0,r.ensureNotNull)(this._model.paneForSource(e)),s=(0,r.ensureNotNull)(n.mainDataSource()).firstValue();if(null===s||!e.canDrawLabelForAlert())return;const o=(0,r.ensureNotNull)(e.priceScale()),a=e=>o.priceToCoordinate(e,s),l=[];if("channel"===i.type){const e=a(i.upper),t=a(i.lower);l.push(e),l.push(t)}else l.push(a(i.price));const c=e.isSelected(),d=e.isHovered(),h=this._model.lastHittestData(),u=this._model.lastSelectedHittestData();let _=0;d&&(_=h?.activeItem??0),c&&(_=u?.activeItem??0);const p=this._alertLabel.colors(),m=e.labelLineColor(),g=n.leftPriceScales().includes(o),b=1===l.length?G.NoLineModeOffsetSingleLine:G.NoLineModeOffsetMultipleLines;if(e.drawHorzLine()||c||d){const t=l.map(((t,i)=>({y:t,mode:e.drawHorzLine()?"full":i===_&&1===l.length?"toTooltip":"toConnector"})));this._compositeRenderer.append(new k({distanceToTooltip:b,levels:t,color:m,isLeft:g,withConnector:c||d}))}if(c||d){const e=n.height(),t=l.map((t=>this._model.backgroundColorAtYPercentFromTop(t/e))),i=g?G.SelectionPointOffset:n.width()-G.SelectionPointOffset;this._compositeRenderer.append(new y.SelectionRenderer({points:l.map(((e,t)=>({point:new v.Point(i,e),lineWidth:c&&_===t?1.5:void 0,hitTestResult:new w.HitTestResult(w.HitTarget.MovePoint,{activeItem:t,hideCrosshairLinesOnHover:!0,areaName:w.AreaName.Line,cursorType:C.PaneCursorType.VerticalResize})}))),hittestResult:w.HitTarget.MovePoint,bgColors:t,visible:!0,barSpacing:this._model.timeScale().barSpacing()}))}if((c||d)&&!this._alertLabel.isMoving()){const i=d&&h?.areaName===w.AreaName.Button,r=g?b:n.width()-b,s=t.name()||(e.isMoving()?t.defaultDescription():t.description()),o=this._alertLabel.isInactive()?p.inActiveTextBaseColor:m,a=async()=>{const e=this._alertLabel.alert().id().value(),i=this._alertLabel.alert().isNew();e&&!i&&(await(0,S.getAlertsActionCreators)()).deleteAlert(e,{confirmation:A([t]),analytics:{actionLabel:"Alert label source",actionSource:"Chart",event:"restart"}}).execute()},c=async()=>{const e=this._alertLabel.alert().id().value(),t=this._alertLabel.alert().isNew();e&&!t&&(await(0,S.getAlertsActionCreators)()).restartAlert(e,{analytics:{actionLabel:"Alert label source",actionSource:"Chart",event:"restart"}}).execute()},u=e.stopReason(),f=void 0!==u,x={isLeft:g,point:new v.Point(r,l[_]),lineIndex:_,center:e.drawHorzLine(),text:s,
textColor:o,additionalText:ie(u),additionalTextColor:re(u,p),lineColor:m,backColor:p.connectorBackColor,buttonType:f?1:0,buttonBorderColor:p.tooltipButtonBorderColor,buttonBackColor:i?p.tooltipButtonBorderColorHovered:p.connectorBackColor,buttonAction:f?c:a,restartIconColor:f?p.restartIconColor:void 0,themeName:this._model.dark().value()?"dark":"light"};this._tooltipRenderer.setData(x),this._compositeRenderer.append(this._tooltipRenderer)}}}var se=i(534328),oe=i(597331);class ae{constructor(e){this._renderers=e??[]}clear(){this._renderers=[]}add(e){this._renderers.push(e)}draw(e,t,i,r,n){for(const s of this._renderers)s.draw(e,t,i,r,n)}lastDrawnBodyBox(){let e=null;for(const t of this._renderers)if(t.lastDrawnBodyBox){const i=t.lastDrawnBodyBox();if(null!==i){if(null===e){e=i;continue}e=(0,v.box)((0,v.point)(Math.min(e.min.x,i.min.x),Math.min(e.min.y,i.min.y)),(0,v.point)(Math.max(e.max.x,i.max.x),Math.max(e.max.y,i.max.y)))}}return e}hitTest(e,t,i){let r=null;for(let n=this._renderers.length-1;n>=0;n-=1){const s=this._renderers[n].hitTest?.(e,t,i);null!=s&&(null===r||s.target()>r.target())&&(r=s)}return r}topBottomTotalHeight(e){const t={top:0,bottom:0,total:0};for(const i of this._renderers){const r=i.topBottomTotalHeight(e);t.top=Math.max(t.top,r.top),t.bottom=Math.max(t.bottom,r.bottom),t.top=t.top+t.bottom}return t}setData(e,t){for(const i of this._renderers)i.setData(e,t)}}var le=i(322604);const ce=new Path2D("M6.21 5.27 1.68 1.06A1 1 0 0 0 0 1.79v8.42a1 1 0 0 0 1.68.73l4.53-4.2a1 1 0 0 0 0-1.47Z");class de{constructor(){this._data=null,this._commonData=null,this._bodyBox=null}setData(e,t){this._data=e,this._commonData=t}lastDrawnBodyBox(){return this._bodyBox}draw(e,t,i,r,n){const s=this._data,o=this._commonData;if(!s||!o)return;const a="right"===n,{horizontalPixelRatio:l,verticalPixelRatio:c,bitmapSize:d,mediaSize:h}=t,{borderSize:u}=i,_=a?d.width:Math.max(1,Math.floor(u*l));e.save(),e.fillStyle=s.backgroung??o.background,e.translate(_,Math.round((o.coordinate-6.5+1)*c)),(0,N.drawScaled)(e,a?-l:l,c,(()=>{e.fill(ce)})),e.restore();{const e=a?h.width-7:0;this._bodyBox=(0,v.box)((0,v.point)(e,o.coordinate-6.5),(0,v.point)(e+7,o.coordinate+6.5))}}topBottomTotalHeight(e){return{top:0,bottom:0,total:0}}hitTest(e,t,i){return this._data?(0,le.hittestByData)(this._data,e):null}}var he;!function(e){e[e.IconMinWidth=23]="IconMinWidth"}(he||(he={}));class ue extends oe.PriceAxisView{constructor(e,t){super(),this._collapsedAxisRenderer=new de,this._lastDrawnAxisBox=null,this._lastDrawnPaneBox=null,this._alertLabel=e,this._levelIndex=t,this._collapsedAxisRenderer.setData(this._axisRendererData,this._commonRendererData)}renderer(){return this._updateRendererDataIfNeeded(),this._rendererImpl()}ignoreAlignment(){return!0}isOutsideOfVisiblePriceRange(){return this._alertLabel.isOutsideOfVisiblePriceRange()}_updateRendererData(e,t,i){if(e.visible=!1,t.visible=!1,!this._alertLabel.labelVisible())return;const r=this._alertLabel.priceScale();if(!r)return;const n=r.mainSource(),s=null!==n?n.firstValue():null
;if(r.isEmpty()||null===s)return;const o=this._alertLabel.priceOfLevel(this._levelIndex);if(null===o)return;const a=this._alertLabel.colors(),l=this._alertLabel.labelLineColor();i.background=(0,se.resetTransparency)(l),i.textColor=a.iconColor,i.coordinate=r.priceToCoordinate(o,s);const c=this._alertLabel.animation();if(null!==c){const e=c.data(performance.now());i.globalAlpha=e.alpha}else i.globalAlpha=void 0;e.text=r.formatPrice(o,s);const d=this._rendererImpl().lastDrawnBodyBox?.()??this._lastDrawnAxisBox;this._lastDrawnAxisBox=d??this._lastDrawnAxisBox,this._lastDrawnAxisBox&&(e.hitTestData={hoverModelFromAxis:!0,itemBox:this._lastDrawnAxisBox,activeItem:this._levelIndex});const h=this._paneRenderer.lastDrawnBodyBox?.()??this._lastDrawnPaneBox;this._lastDrawnPaneBox=h??this._lastDrawnPaneBox,this._lastDrawnPaneBox&&(t.hitTestData={hoverModelFromAxis:!0,itemBox:this._lastDrawnPaneBox,activeItem:this._levelIndex}),t.hitTarget=w.HitTarget.MovePoint,e.hitTarget=w.HitTarget.Regular,t.labelIcon=1,t.labelIconMinWidth=he.IconMinWidth,t.visible=!0,e.visible=!0}_rendererImpl(){return null===this._alertLabel.animation()?this._alertLabel.isHovered()||this._alertLabel.isSelected()?this._axisRenderer:this._collapsedAxisRenderer:new ae([this._collapsedAxisRenderer,this._axisRenderer])}}var _e=i(335048);const pe=l.sortSourcesPreOrdered.AlertLabel,me=l.sortSourcesPreOrdered.AlertLabelInactive,ge=5;function be(e){return e instanceof xe}const ve={newAlertColor:(0,n.getHexColorByName)("color-cold-gray-450"),inActiveAlertColor:(0,n.getHexColorByName)("color-cold-gray-600"),inActiveTextBaseColor:(0,n.getHexColorByName)("color-cold-gray-450"),inActiveTextManualColor:(0,n.getHexColorByName)("color-cold-gray-450"),inActiveTextTriggeredColor:(0,n.getHexColorByName)("color-tan-orange-500"),inActiveTextExpiredColor:(0,n.getHexColorByName)("color-ripe-red-500"),connectorBackColor:(0,n.getHexColorByName)("color-cold-gray-900"),iconColor:(0,n.getHexColorByName)("color-cold-gray-900"),restartIconColor:(0,n.getHexColorByName)("color-cold-gray-200"),tooltipButtonBorderColor:(0,n.getHexColorByName)("color-cold-gray-800"),tooltipButtonBorderColorHovered:(0,n.getHexColorByName)("color-cold-gray-800")},fe={newAlertColor:(0,n.getHexColorByName)("color-cold-gray-450"),inActiveAlertColor:(0,n.getHexColorByName)("color-cold-gray-300"),inActiveTextBaseColor:(0,n.getHexColorByName)("color-cold-gray-550"),inActiveTextManualColor:(0,n.getHexColorByName)("color-cold-gray-550"),inActiveTextTriggeredColor:(0,n.getHexColorByName)("color-tan-orange-500"),inActiveTextExpiredColor:(0,n.getHexColorByName)("color-ripe-red-500"),connectorBackColor:(0,n.getHexColorByName)("color-white"),iconColor:(0,n.getHexColorByName)("color-white"),restartIconColor:(0,n.getHexColorByName)("color-cold-gray-900"),tooltipButtonBorderColor:(0,n.getHexColorByName)("color-cold-gray-100"),tooltipButtonBorderColorHovered:(0,n.getHexColorByName)("color-cold-gray-100")};class xe extends a.DataSource{constructor(e,t,i,n){super(),this._priceAxisViews=[],this._paneLabelsPaneViews=[],
this._propertyMock=new c.Property,this._startMovingPoint=null,this._currentMovingPoint=null,this._animation=null,this._isOutsideOfVisiblePriceRange=new p.WatchedValue(!0),this._onConditionChanged=()=>{const e=this.alert().condition(),t=e?"channel"===e.type?2:1:0;if(this._priceAxisViews.length!==t){for(let e=this._priceAxisViews.length;e<t;e++){const t=new ue(this,e);this._priceAxisViews.push(t),this._paneLabelsPaneViews.push(new d.PanePriceAxisView(t,this,this._model))}this._priceAxisViews=this._priceAxisViews.slice(0,t),this._paneLabelsPaneViews=this._paneLabelsPaneViews.slice(0,t)}this._priceScale&&this._updatePriceLabelInVisibleRange(this._priceScale.priceRangeInPrice()),this._model.lightUpdate()},this._propertyMock.addProperty("visible",!0),this._model=e,this._alert=t,this._alertOwnerSource=i,this._paneView=new ne(this,e),this._invokeAlertEditor=n,this._resetUserEditEnabled(),this._hasAlert.setValue(!0),this._alertSeriesId=(0,r.ensureNotNull)(t.seriesId()),this._alertId=t.id().spawn(),this._alertId.subscribe(this._resetUserEditEnabled.bind(this)),t.onConditionChanged().subscribe(this,this._onConditionChanged),this._onConditionChanged(),this._isBeingEdited=t.isBeingEditedInDialog().spawn(),this._isBeingEdited.subscribe(this._resetUserEditEnabled.bind(this)),this._selected=t.selected().spawn(),this._selected.subscribe(this._onAlertSelectedChanged.bind(this)),this._selected.value()&&this.canDrawLabelForAlert()&&this._selectAlertLabel(),this._localFireTime=t.localFireTime().spawn(),this._localFireTime.subscribe(this._onAlertFireTimeChanged.bind(this),{callWithLast:!0}),(0,b.getLabelsSettingsProperty)().subscribe(this,(()=>e.updateSource(this))),this._active=t.active().spawn(),this._active.subscribe((()=>e.updateSource(this))),this._isOutsideOfVisiblePriceRange.subscribe((()=>e.updateSource(this)))}destroy(){this._alertId.destroy(),this._isBeingEdited.destroy(),this._localFireTime.destroy(),this._active.destroy(),this._selected.destroy(),(0,b.getLabelsSettingsProperty)().unsubscribeAll(this),this._alert.onConditionChanged().unsubscribeAll(this),this._priceScale?.priceRangeChanged().unsubscribeAll(this),super.destroy()}model(){return this._model}zorder(){return this.isInactive()?me:pe}colors(){return{...this._themedColors(),lineColor:this.labelLineColor()}}alertOwnerSource(){return this._alertOwnerSource}alertSeriesId(){return this._alertSeriesId}alignCrossHairToMovePoint(){return!0}name(){return"AlertLabel"}isSpeciallyZOrderedSource(){return!0}stop(){this._alertId.unsubscribe(this._resetUserEditEnabled),this._isBeingEdited.unsubscribe(this._resetUserEditEnabled),this._selected.unsubscribe(this._onAlertSelectedChanged)}alert(){return this._alert}isMoving(){return null!==this._startMovingPoint}isHovered(){return this===this._model.hoveredSource()}isSelected(){return this._model.selection().isSelected(this)}alertId(){return this.alert().id().value()}getAlert(){return Promise.resolve(this._alert)}getAlertSync(){return this._alert}priceOfLevel(e){const t=this.alert().condition()
;return t?"channel"===t.type?[t.upper,t.lower][e]:t.price:null}convertYCoordinateToPriceForMoving(e,t){const i=this.priceScale();if(!t||!i||i.isEmpty())return null;const r=t.firstValue();return null===r?null:i.coordinateToPrice(e,r)}isSynchronizable(){return!1}state(){const e=this.alert().condition(),t=[];return null!==e&&("channel"===e.type?(t.push({price:e.upper}),t.push({price:e.lower})):t.push({price:e.price})),{id:this._id.value(),type:"AlertLabel",zorder:this.zorder(),points:t}}restorePoints(e){}createServerPoints(){}properties(){return this._propertyMock}paneViews(){return window.TradingView.printing||!this.labelVisible()?null:[this._paneView]}topPaneViews(){const e=performance.now();return null!==this._animation&&this._continueOrFinishAnimation(e),!window.TradingView.printing&&this.labelVisible()&&this._animationActive(e)?(this.updateAllViews((0,_.sourceChangeEvent)(this.id())),this._paneLabelsPaneViews):null}dataWindowView(){return null}priceAxisViews(e,t){return!window.TradingView.printing&&this.labelVisible()&&this.priceScale()===t&&!this._animationActive()&&this.canDrawLabelForAlert()?this._priceAxisViews:null}topPriceAxisViews(e,t){const i=performance.now();return null!==this._animation&&this._continueOrFinishAnimation(i),this.priceScale()===t&&this._animationActive(i)&&this.canDrawLabelForAlert()?(this.updateAllViews((0,_.sourceChangeEvent)(this.id())),this._priceAxisViews):[]}updateAllViews(e){this._paneView.update(),this._priceAxisViews.forEach((t=>t.update(e))),this._paneLabelsPaneViews.forEach((t=>t.update(e)))}pointsCount(){return 0}title(){return this.alert().title()}movable(){return!this._alert.isBeingEditedInDialog().value()&&!this._alert.isNew()}startMoving(e,t,i,r){this._userEditEnabled=!1,this._startMovingPoint=e,this.alert().startEditing()}move(e,t,i,n){if(!e.logical||null===t)return;const s=e.logical.price,o=this.alert(),a=(0,r.ensureNotNull)(o.condition());if(this._currentMovingPoint={...e},"channel"===a.type){let{upper:e,lower:i}=a;const n=this._alertOwnerSource.base()||100;0===t?(0,r.ensureDefined)(this._currentMovingPoint.logical).price=e=Math.max(s,i+1/n):1===t&&((0,r.ensureDefined)(this._currentMovingPoint.logical).price=i=Math.min(s,e-1/n)),o.setCondition({...a,lower:(0,m.roundAlertValueUsingPrecision)(this._alertOwnerSource,i),upper:(0,m.roundAlertValueUsingPrecision)(this._alertOwnerSource,e)})}else o.setCondition({type:"price",price:(0,m.roundAlertValueUsingPrecision)(this._alertOwnerSource,s)});this.updateAllViews((0,_.sourceChangeEvent)(this.id()))}endMoving(){const e=this._startMovingPoint,t=this._currentMovingPoint;if(this._userEditEnabled=!0,this._startMovingPoint=null,this._currentMovingPoint=null,!e||!t||e===t)return;(0,g.trackEvent)("chart_alert","edit","move"),this._invokeAlertEditor({dataSourceHub:this._model,alert:this.alert(),type:"edit_alert",onEditCancel:()=>{setTimeout((async()=>{if(this.isInactive()){const e=this.alert().id().value();void 0!==e&&(await(0,S.getAlertsActionCreators)()).restartAlert(e,{analytics:{actionLabel:"Alert label source",actionSource:"Chart",
event:"restart"}}).execute()}else this.alert().abortEditing();this._model.lightUpdate()}),0)},silent:!0,actionSource:"alert_label_move",onAborted:()=>this.alert().abortEditing()})}currentMovingPoint(){return this._currentMovingPoint}showInObjectTree(){return!1}isRemovedByStudyTemplates(){return!1}isUserDeletable(){return!1}doesMovingAffectsUndo(){return!1}drawHorzLine(){return this.labelLineVisible()}canDrawLabelForAlert(){const e=this.alert(),t=this._model.mainSeries(),i=t&&t.properties().childs(),r=i&&i.style&&i.style.value(),n=(0,u.isRangeBasedStyle)(r)?r:null,s=e.crossInterval()||h.Interval.isEqual(e.resolution(),t.interval()),o=e.rangeBasedStyle()===n;return e.isPrice()&&s&&o}labelVisible(){const e=this._alertOwnerSource.symbolSource();if(e&&(e.isConvertedToOtherCurrency()||e.isConvertedToOtherUnit()))return!1;if(this._model.isInReplay().value())return!1;if(!this.isInactive())return(0,b.getLabelsSettingsProperty)().childs().visible.value();const t=this.stopReason();return void 0!==t&&(t===s.AlertStopReason.Created||this._animationActive()||!this.showOnlyActive())}labelLineColor(){const e=(0,b.getLabelsSettingsProperty)().childs().line.childs().color.value(),t=e||(0,b.getAlertColorLineByTheme)(this.model());if(null!==this._animation)return(0,r.ensureDefined)(t);const i=this._themedColors();return this._alert.isNew()?(0,r.ensureDefined)(i.newAlertColor):this._alert.active().value()||this._alert.stopReason()===s.AlertStopReason.Created?t:(0,r.ensureDefined)(i.inActiveAlertColor)}labelLineVisible(){return(0,b.getLabelsSettingsProperty)().childs().line.childs().visible.value()}showOnlyActive(){return(0,b.getLabelsSettingsProperty)().childs().showOnlyActive.value()}stopReason(){return this.isInactive()?this._alert.stopReason():void 0}animation(){return this._animation}isInactive(){return!this._alert.active().value()&&!this._alert.isNew()}setPriceScale(e){this._priceScale?.priceRangeChanged().unsubscribeAll(this),e&&(e.priceRangeChanged().subscribe(this,(()=>this._updatePriceLabelInVisibleRange(e.priceRangeInPrice()))),this._updatePriceLabelInVisibleRange(e.priceRangeInPrice())),super.setPriceScale(e)}isOutsideOfVisiblePriceRange(){return this._isOutsideOfVisiblePriceRange.value()}contextMenuStatName(){return"AlertLabelContextMenu"}_updatePriceLabelInVisibleRange(e){this._isOutsideOfVisiblePriceRange.setValue(!!(()=>{if(null===e)return;const t=this.alert().condition();if(!t)return;const{from:i,to:r}=e;return"channel"===t.type?t.upper<i||t.lower>r:t.price<i||t.price>r})())}_themedColors(){return this._model.dark().value()?ve:fe}_resetUserEditEnabled(){const e=this._alert;this._userEditEnabled=!(e.isBeingEditedInDialog().value()||e.isNew()||!e.isPrice()||null===e.condition()),(0,g.trackEvent)("chart_alert","edit",`change_user_edit_enabled to ${this._userEditEnabled} for alert ${e.id().value()}`)}_onAlertSelectedChanged(e){this.canDrawLabelForAlert()&&(e?this._selectAlertLabel():this._unselectAlertLabel())}_selectAlertLabel(){this._model.selectionMacro((e=>{e.selection().isSelected(this)||(e.clearSelection(),
e.addSourceToSelection(this))}))}_unselectAlertLabel(){this._model.selectionMacro((e=>{e.selection().isSelected(this)&&e.removeSourceFromSelection(this)}))}_onAlertFireTimeChanged(e){var t,i;null!==e&&(this._animation=(t=e,i=this.isHovered()||this.isSelected()?1:0,{finished:e=>e-t>=2400,data:e=>{const r=Math.min(e-t,2400)%1200,n=r%600,s=Math.round(r/1200),o=(0,_e.easingFunc.linear)(n/600);return{alpha:0===s==(0===i)?o:1-o}}}),this._model.updateSource(this))}_continueOrFinishAnimation(e){(0,r.ensureNotNull)(this._animation).finished(e)?(this._animation=null,this._model.updateSource(this)):this._model.invalidate(o.InvalidationMask.cursor())}_animationActive(e=performance.now()){return null!==this._animation&&!this._animation.finished(e)}}},738834:(e,t,i)=>{"use strict";i.d(t,{BarsMarksContainer:()=>p});var r=i(650151),n=i(735566),s=i(62802),o=i(931924),a=i(477786),l=i(536794),c=i(388741),d=i(644036),h=i(437642);const u=(0,n.getLogger)("Chart.BarsMarksContainer"),_=Math.round(new Date(2037,0,1).getTime()/1e3);class p extends d.DataSource{constructor(e,t,i){const n=e.onWidget();let a;a=n?!e.hideIdeas():!!o.enabled("bars_marks")&&s.default.getBool("BarsMarksContainer.visibile",!1),t.merge({visible:a}),t.childs().visible.subscribe(null,(t=>{n||e.isSnapshot()||!o.enabled("bars_marks")||s.default.setValue("BarsMarksContainer.visibile",!!t.value())})),super(i),this._paneViews=[],this._model=e,this._properties=t,this._requests=[],this._marks={},this._loadedRange=null,this._getDataTimeout=null,this._collectedRange=null,this._lastRange=null;const l=this._model.mainSeries();l.onSymbolIntervalChanged().subscribe(this,this.clearMarks),l.dataEvents().symbolResolved().subscribe(this,this.clearMarks),l.dataEvents().completed().subscribe(this,(()=>{const e=l.data();if(0===e.size())return;const t=(0,r.ensureNotNull)(e.first()).index,i=(0,r.ensureNotNull)(e.last()).index,n=this.timeScale();this.getData({start:n.indexToTimePoint(t)??1/0,end:n.indexToTimePoint(i)??-1/0})})),this._initialize(),this._pinnedTooltips={}}destroy(){const e=this._model.mainSeries();e.onSymbolIntervalChanged().unsubscribeAll(this),e.dataEvents().symbolResolved().unsubscribeAll(this),e.dataEvents().completed().unsubscribeAll(this),super.destroy()}model(){return this._model}properties(){return this._properties}marks(){return this._marks}pinTooltip(e,t){this._pinnedTooltips[e]=t}timeScale(){return this._model.timeScale()}getIntervalInTicks(){const e=this._model.mainSeries().properties().childs().interval.value(),t=a.Interval.parse(e);if(!t.isValid())throw new TypeError("Unexpected interval");return t.isRange()?60:t.inMilliseconds()/1e3}getVisibleTickMarksRange(){if(this.timeScale().isEmpty())return{start:0,end:0};const e=(0,r.ensureNotNull)(this.timeScale().visibleBarsStrictRange()),{firstIndex:t,lastIndex:i}=(0,r.ensureNotNull)(this.timeScale().points().range().value());if(!(e.lastBar()>t&&e.firstBar()<i))return{start:0,end:0};let n;n=e.lastBar()<i?this.timeScale().indexToTimePoint(e.lastBar()):_;const s={
start:this.timeScale().indexToTimePoint(Math.max(e.firstBar(),t)),end:n};return{start:s.start??1/0,end:s.end??-1/0}}getVisibleRangePlates(){const e=[],t=this.getVisibleTickMarksRange(),i=this.getIntervalInTicks();return Object.keys(this._marks).forEach((r=>{const n=this._marks[r],s=n.tickmark;s>=(t.start??1/0)&&s<=(t.end??-1/0)+i&&e.push(n)})),e}getPublishedPlates(){const e={};return window.is_authenticated?(this.getVisibleRangePlates().forEach((t=>{t.is_public&&(this._pinnedTooltips[t.id]||t.user__id===window.user.id)&&(e[t.id]=t)})),e):e}filterDisplayedPlates(e){const t=e.reduce(((e,t)=>{const i=this._getIndex(t.tickmark);return null!==i&&(e[i]=e[i]||[],e[i].push(t)),e}),{});return Object.keys(t).reduce(((e,i)=>{let r=t[i];return r=r.sort(((e,t)=>t.views_count-e.views_count)),r=r.slice(0,10),e.concat(r)}),[])}getPlatesViewData(){const e=this._model.mainSeries();if(e.data().isEmpty())return[];const t=(0,c.isPriceSourceStyle)(e.style())?e.barFunction():null,i=this.filterDisplayedPlates(this.getVisibleRangePlates()),n={},s=this._model.lastHittestData()??this._model.lastSelectedHittestData();let o=null;null!==s&&this._model.hoveredSource()===this&&(o=s.activeItem??null);const a=[];for(const e of i){const i=(0,r.ensureNotNull)(this._getIndex(e.tickmark)),s=this._getBar(i);if(null===s)continue;const l=this._layout(e.direction),c=this._theme(e.direction),d=o===e.id,h=this.timeScale().indexToCoordinate(i),u=this._offset(l,s,t),_=(0,r.ensureNotNull)(this.priceScale()).isInverted();let p=0;i in n||(n[i]={up:0,down:0}),p=n[i][l]++,a.push({id:e.id,x:h,y:u,yInverted:_,order:p,direction:l,theme:c,hovered:d,pinned:!0===this._pinnedTooltips[e.id],user__id:e.user__id,label:e.label,labelFontColor:e.labelFontColor||"#444",minSize:e.minSize||5,...this._plateViewData(e)})}const l=a.filter((e=>!0===e.hovered));for(let e=0;e<i.length;e++)i[e].user__id===l[0]?.user__id&&(i[e].highlightByAuthor=!0);return a.sort(((e,t)=>e.hovered&&!t.hovered?1:0)),a}priceAxisViews(){return null}updateAllViews(e){for(const t of this._paneViews)t.update(e)}updateAllViewsAndRepaint(){this.updateAllViews((0,h.sourceChangeEvent)(this.id())),this._model.updateSource(this)}roundRange(e){return{start:Math.round(e.start),end:Math.round(e.end)}}refreshData(){null!==this._lastRange&&this.getData(this._lastRange)}getData(e){(0,l.isNumber)(e.start)&&(0,l.isNumber)(e.end)?(this._lastRange=e,e.end=_,this._pushGetDataStack(Object.assign({},e))):u.logError("Wrong range")}clearMarks(){this._abortAllRequests(),this._marks={},this._loadedRange=null}isUserDeletable(){return!1}isSavedInChart(e){return!1}isSpeciallyZOrderedSource(){return!0}showInObjectTree(){return!1}_plateViewData(e){return{}}_layout(e){switch(e){default:case 0:case 2:case 3:case 4:case 5:case 6:return"up";case 1:return"down"}}_theme(e){switch(e){default:case 0:return"neutral";case 1:case 5:return"green";case 2:case 6:return"red";case 3:return"yellow";case 4:return"blue"}}_offset(e,t,i){let n;switch(e){default:case"up":n=null===i?t[2]:i(t);break;case"down":n=null===i?t[3]:i(t)}return(0,
r.ensureNotNull)(this.priceScale()).priceToCoordinate(n,(0,r.ensureNotNull)((0,r.ensureNotNull)(this.ownerSource()).firstValue()))}_getIndex(e){return this.timeScale().timePointToIndex(e)}_getBar(e){return this._model.mainSeries().data().valueAt(e)}_rangeDifference(e){return e=Object.assign({start:1/0,end:-1/0},e),this._loadedRange&&(e.start<this._loadedRange.start?e.end=this._loadedRange.start:e.end>this._loadedRange.end&&(e.start=this._loadedRange.end)),e}_rangeUnion(e,t){return e=Object.assign({start:1/0,end:-1/0},e),t&&(e.start=Math.min(t.start,e.start),e.end=Math.max(t.end,e.end)),e}_pushGetDataStack(e){(0,l.isNumber)(e.start)&&(0,l.isNumber)(e.end)?(this._getDataTimeout&&clearTimeout(this._getDataTimeout),this._collectedRange=this._rangeUnion(e,this._collectedRange),this._getDataTimeout=setTimeout((()=>{this._getData(this._collectedRange),this._getDataTimeout=this._collectedRange=null}),300)):u.logError("Wrong tickmark range")}_abortAllRequests(){this._requests.forEach((e=>{e.cancel()})),this._requests=[],this._getDataTimeout&&clearTimeout(this._getDataTimeout),this._getDataTimeout=this._collectedRange=null}}},570244:(e,t,i)=>{"use strict";var r;i.d(t,{ChartEventsSourceId:()=>r}),function(e){e.Value="ChartEventsSource"}(r||(r={}))},54365:(e,t,i)=>{"use strict";var r;i.d(t,{PublishedChartsFilter:()=>r}),function(e){e.None="all",e.Following="following",e.Private="private"}(r||(r={}))},207153:(e,t,i)=>{"use strict";i.d(t,{PublishedChartsTimeline:()=>E});var r=i(444372),n=i(62802),s=i(738834),o=i(180349),a=i(54365),l=i(735566),c=i(345848),d=i(638456),h=i(999102),u=i(803912),_=i(223124),p=i(890390),m=i(650151),g=i(790188),b=i(542682),v=i(934026),f=i(86441),x=i(731974),w=i(688857),y=i(765935);function C(e,t){const{horizontalPixelRatio:i,verticalPixelRatio:r}=t,n=Math.max(1,Math.floor(i)),s=Math.round(e.x*i)+n%2/2;let o=Math.round(e.size*i);(s+o/2)%1!=0&&(o+=1);const a=Math.min(Math.max(1,Math.round(i*e.borderWidth)),o/2);let l;const c=("up"===e.direction?-1:1)*(e.yInverted?-1:1),d=c*(Math.round(e.size*r/2)+n%2);if(void 0!==e.fixedSpaceYPosition){const t=Math.round(e.fixedSpaceYPosition.itemSpacing*r),i=e.fixedSpaceYPosition.order,n=c*(o*i+t*(i+1));l=Math.round(e.fixedSpaceYPosition.basePosition*r)+n+d}else l=Math.round(e.y*r)+d;return{x:s,y:l,size:o,borderWidth:a,tickSize:n}}function S(e,t,i,r){if(e.save(),i&&!r.highlightByAuthor&&(e.globalAlpha=.4),r.mine)!function(e,t,i){const{borderColor:r,backgroundColor:n,doNotFill:s,direction:o,yInverted:a}=i,{x:l,y:c,borderWidth:d,size:h,tickSize:u}=C(i,t);e.strokeStyle=r,e.fillStyle=n,e.lineWidth=d;const _="up"===o!==a?-1:1;let p=Math.round(h/2/Math.tan(Math.PI/6))+u%2/2;(l+p/2)%1!=0&&(p-=1);e.translate(l,c+p/2*_),e.beginPath();const m=d/2;e.moveTo(0,-_*(p-m)),e.lineTo(h/2-m,d/2),e.lineTo(-h/2+m,d/2),e.lineTo(0,-_*(p-d/2)),e.closePath(),s||e.fill();e.stroke()}(e,t,r);else{0,function(e,t,i,r){const{borderColor:n,backgroundColor:s,label:o}=i,{x:a,y:l,borderWidth:c,size:d}=C(i,t);e.strokeStyle=n,e.fillStyle=s,e.lineWidth=c,e.beginPath();const h=d/2-c/2
;e.arc(a,l,h,0,2*Math.PI,!0),e.closePath(),e.fill(),!1;e.stroke(),!r&&o&&d/2>=7&&(e.textAlign="center",e.textBaseline="middle",e.font=o.font,e.fillStyle=o.fontColor,(0,w.drawScaled)(e,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{e.fillText(o.text,a/t.horizontalPixelRatio,l/t.verticalPixelRatio)})))}(e,t,r,!1,r.image)}e.restore()}class P{constructor(e,t,i,r){this._canvas=null,this._clickHandler=e,this._enterHandler=t,this._leaveHandler=i,this._data=r??null}setData(e){this._data=e}hitTest(e,t){if(null===this._data)return null;for(let i=this._data.items.length-1;i>=0;--i){const r=this._hitTestDot(this._data.items[i],e,t);if(r)return r}return null}draw(e,t){this._canvas=e.canvas,null!==this._data&&this._data.items.forEach(S.bind(null,e,t,this._data.highlightByAuthor))}_hitTestDot(e,t,i){const r=new f.Point(e.x,C(e,i).y/i.verticalPixelRatio);if((0,v.pointInCircle)(t,r,Math.max(e.size/2,8))){const t=this._canvas,i=null===t?void 0:{mouseEnterHandler:()=>this._enterHandler(e,r.y,t),mouseLeaveHandler:()=>this._leaveHandler(),clickHandler:i=>this._clickHandler(e,r.y,t,i),tapHandler:i=>this._clickHandler(e,r.y,t,i)};return new x.HitTestResult(x.HitTarget.Regular,{activeItem:e.originalItem.id,cursorType:y.PaneCursorType.Default,...i})}return null}}var T=i(837462),A=i(910282),M=i(312520);const R={green:{border:(0,g.getHexColorByName)("color-minty-green-700"),background:(0,g.getHexColorByName)("color-minty-green-a600")},red:{border:(0,g.getHexColorByName)("color-ripe-red-700"),background:(0,g.getHexColorByName)("color-ripe-red-500")},neutral:{border:(0,g.getHexColorByName)("color-tan-orange-700"),background:(0,g.getHexColorByName)("color-tan-orange-500")},yellow:{border:"#EAC300",background:"#FFD400"},blue:{border:"#047ACE",background:"#0496FF"}};class I{constructor(e,t){this._tooltip=null,this._hoveredBarsMarkData=null,this._destroyed=!1,this._invalidated=!0,this._originalData=[],this._source=e,this._model=t,this._renderer=new P(this._onItemClicked.bind(this),this._showItem.bind(this),this._hideItem.bind(this)),this._createTooltipRenderer().then((e=>{this._destroyed?e?.destroy():this._tooltip=e})),e.properties().childs().visible.subscribe(null,(()=>{this._tooltip?.hide(!0)}))}destroy(){this._destroyed=!0,this._tooltip?.destroy()}source(){return this._source}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}onClickOutside(e,t){t&&((0,M.isTouchMouseEvent)(t)?t.isTouch:(0,b.isTouchEvent)(t))&&null!==this._tooltip&&!this._tooltip.contains(t.target)&&this._tooltip.hide(!0)}_extractBarMarksRendererItemData(e,t){const i=t.overridedTheme??R[t.theme],r=this._calculateSize(e,t),n=this._calculateY(e,r,t);return null===this._hoveredBarsMarkData||this._hoveredBarsMarkData.id!==t.id||this._hoveredBarsMarkData.x===t.x&&this._hoveredBarsMarkData.y===Math.round(n)||(this._tooltip?.hide(!0),this._hoveredBarsMarkData=null),{x:t.x,y:this._calculateY(e,r,t),direction:t.direction,borderColor:i.border,borderWidth:B(t),backgroundColor:i.background,size:r,doNotFill:!t.public,
yInverted:t.yInverted,label:void 0===t.label?void 0:{text:t.label,fontColor:t.labelFontColor,font:(0,T.makeFont)(Math.ceil(Math.max(10,Math.min(r/2,20))),A.CHART_FONT_FAMILY,"bold")},originalItem:t}}_onItemClicked(e,t,i,r){r.isTouch&&this._showItem(e,t,i)}async _showItem(e,t,i){const r=await this._tooltipProps(e);if(null===r)return;const n=this._model.timeScale().barSpacing(),s=this._calculateSize(n,e.originalItem);this._hoveredBarsMarkData={x:e.x,y:Math.round(this._calculateY(n,s,e.originalItem)),id:e.originalItem.id},this._tooltip?.show({itemSize:s,container:(0,m.ensureNotNull)(i.parentElement),x:e.x,y:t,factoryProps:r,onClickOutside:()=>this._tooltip?.hide(!0)})}_hideItem(){this._tooltip?.hide()}_calculateSize(e,t){return Math.min(553,Math.max(7,t.minSize,.8*e))}_updateImpl(){this._originalData=this._source.getPlatesViewData();const e=this._model.timeScale().barSpacing(),t=this._originalData.map(this._extractBarMarksRendererItemData.bind(this,e));this._renderer.setData({items:t,barSpacing:e,highlightByAuthor:!1})}}function B(e){return e.hovered||e.highlightByAuthor?e.overrideBorderWidth?.hoveredWidth??4:e.overrideBorderWidth?.width??2}const D=(0,l.getLogger)("Chart.PublishedChartsTimeline");class k extends I{constructor(){super(...arguments),this._profileDataCache=new Map}_extractBarMarksRendererItemData(e,t){const i=super._extractBarMarksRendererItemData(e,t);return{...i,fixedSpaceYPosition:{basePosition:t.y,order:t.order,itemSpacing:.2857142857142857*e},mine:t.mine,borderWidth:t.hovered?i.borderWidth:t.public?1:2,doNotFill:!t.public,direction:t.direction}}async _createTooltipRenderer(){const[{TooltipRenderer:e},{PublishedChartsTimelineTooltip:t}]=await Promise.all([Promise.all([i.e(19190),i.e(93240),i.e(82332),i.e(85014),i.e(81936),i.e(82321),i.e(70354)]).then(i.bind(i,467489)),Promise.all([i.e(19190),i.e(93240),i.e(82332),i.e(85014),i.e(81936),i.e(82321),i.e(70354)]).then(i.bind(i,211138))]);return new e(t)}_calculateY(e,t,i){const r=("up"===i.direction?-1:1)*(i.yInverted?-1:1),n=r*(t*i.order+.2857142857142857*t*(i.order+1));return i.y+t/2*r+n}_onItemClicked(e,t,i,r){super._onItemClicked(e,t,i,r),r.isTouch||this.source().showIdea(e.originalItem.id,!1)}async _tooltipProps(e){const t=(0,m.ensureDefined)(e.originalItem.username);let i=this._profileDataCache.get(t);if(void 0===i){try{i=await function(e){return fetch(`/api/v1/user/profile/${e}/?avatars_fallback=true&by=username`).then((e=>e.json()))}(t)}catch(e){return D.logWarn(`An error ocurred while loading profile data: ${e}`),null}this._profileDataCache.set(t,i)}return Promise.resolve({avatarUrl:i.avatars?.mid,badges:i.badges,title:(0,m.ensureDefined)(e.originalItem.title),username:t,onTitleClicked:()=>this.source().showIdea(e.originalItem.id,!1)})}}var L=i(839800),N=i(314802);const V=(0,l.getLogger)("Chart.PublishedChartsTimeLine");class E extends s.BarsMarksContainer{constructor(e,t){let i=n.default.getValue("PublishedChartsTimeline.filter",a.PublishedChartsFilter.None);window.is_authenticated||(i=a.PublishedChartsFilter.None);const r=new p.DefaultProperty({
defaultName:"publishedchartstimeline",state:{filter:i}});super(e,r),this.setId("PublishedChartsTimeline"),this._paneView=new k(this,e),this._paneViews=[this._paneView],this._currentRange=null,this._properties.childs().visible.subscribe(this,(()=>{this._getData(this._currentRange)})),r.childs().filter.subscribe(this,(e=>{n.default.setValue("PublishedChartsTimeline.filter",e.value()),this.clearMarks(),this._getData(this._currentRange)})),this._containsData=e.isSnapshot(),this._containsData&&this._properties.childs().visible.setValue(!0),this.setUserEditEnabled(!1),this._onIdeaClickedHandler=t}destroy(){this._onIdeaClickedHandler=null,this._boundOnMessage&&(o.pushStreamMultiplexer.off("ideas",this._boundOnMessage),o.pushStreamMultiplexer.off("ideas.post",this._boundOnMessage),this._boundOnMessage=null),this._paneView.destroy(),super.destroy()}name(){return"Ideas on chart"}title(){return r.t(null,void 0,i(958757))}zorder(){return L.sortSourcesPreOrdered.BarMarks}paneViews(){return this._model.isInReplay().value()||!this._properties.childs().visible.value()?[]:this._paneViews}showIdea(e,t){const i=this._marks[e];i?((0,c.trackEvent)("GUI","View published idea"),t&&(0,c.trackEvent)("GUI","Ideas navigation arrow"),(0,d.onWidget)()||this._containsData||(0,N.isOnMobileAppPage)("any")?window.open(`${this._getBaseUrl()}${i.published_chart_url||"/v/"+i.image_url+"/"}`):i.image_url&&this._onIdeaClickedHandler?.({uid:i.image_url,url:i.published_chart_url})):V.logDebug("PublishedChartsTimeline.showIdea: unexpected published chart id")}state(e){const t={type:"BarsMarksContainer",id:this.id(),zorder:this.zorder(),pinnedTooltips:this._pinnedTooltips};return e&&this._properties.childs().visible.value()&&(t.marks=this.getPublishedPlates()),t}restoreData(e,t){null!=e.pinnedTooltips&&(this._pinnedTooltips=e.pinnedTooltips),t&&void 0!==e.marks&&(this._marks=e.marks)}onClickOutside(e,t){this._paneView.onClickOutside(e,t)}contextMenuStatName(){return"PublishedChartsTimelineContextMenu"}_getIndex(e){return this.timeScale().timePointToIndex(e,1)}_initialize(){o.pushStreamMultiplexer&&(this._boundOnMessage=this._onMessage.bind(this),o.pushStreamMultiplexer.on("ideas",this._boundOnMessage),o.pushStreamMultiplexer.on("ideas.post",this._boundOnMessage))}_plateViewData(e){return{title:e.title,user_id:e.user__id,username:e.username,suggested:e.is_hot,mine:e.user__id===window.user.id,public:e.is_public}}_getData(e,t){const i=this._model.mainSeries().properties().childs(),r=this._model.mainSeries().symbolInfo();if(this._currentRange=e,!r||!this._properties.childs().visible.value()&&!t)return Promise.resolve([]);let n=r.base_name.length>1?r.base_name:[r.pro_name];const s=this.roundRange(this._rangeDifference(e));n=(0,h.uniq)(n),n=n.sort();const o=new FormData;o.append("interval",i.interval.value()),o.append("legs",JSON.stringify(n)),o.append("startTickmark",s.start.toString()),o.append("endTickmark",s.end.toString()),o.append("filter",this.properties().childs().filter.value());const a=(0,_.makeCancelable)(new Promise(((e,t)=>{(0,
u.fetch)("/charttimeline/",{method:"POST",body:o,headers:new Headers({acccept:"application/json","X-Requested-With":"XMLHttpRequest"})}).then((i=>{i.ok?i.json().then(e):t()})).catch(t)})));return a.promise.then((t=>{t.forEach((e=>{this._marks[e.id]=e})),this._loadedRange=this._rangeUnion(e,this._loadedRange);const i=this._requests.indexOf(a);~i&&this._requests.splice(i,1),this.updateAllViewsAndRepaint()})),this._requests.push(a),a.promise}_onMessage(e,t,i,r){if(this._containsData)return;const n=this._model.mainSeries(),s=n.symbolInfo(),o=s&&s.base_name;if(!o)return;const a=n.properties().childs();e.interval===a.interval.value()&&~o.indexOf(e.pro_symbol)&&(this._marks[e.id]=e,this.updateAllViewsAndRepaint())}_getBaseUrl(){if((0,d.onWidget)()&&window.locale_domains){const e=window.locale||"en",t=window.locale_domains[e]?window.locale_domains[e]:window.locale_domains.en;return t?document.location.protocol+"//"+t:""}return""}}},538235:(e,t,i)=>{"use strict";i.d(t,{sourcesAffectState:()=>s});var r=i(63358),n=i(472354);function s(e){return!n.lineToolsDoNotAffectChartInvalidation||e.some((e=>!(0,r.isLineTool)(e)))}},5481:(e,t,i)=>{"use strict";i.d(t,{getAlertsActionCreators:()=>n});var r=i(481251);const n=(0,r.default)((async()=>new((await Promise.all([i.e(63324),i.e(90345),i.e(26312),i.e(72738),i.e(27568),i.e(98218),i.e(49502)]).then(i.bind(i,604209))).AlertsActionCreators)));(0,r.default)((async()=>new((await Promise.all([i.e(74226),i.e(98218),i.e(68074)]).then(i.bind(i,816094))).FiresActionCreators)))},311848:(e,t,i)=>{"use strict";i.d(t,{getAlertDescription:()=>a});var r=i(955722),n=i(650151),s=i(377464);var o=i(939037);function a(e){return function(e){return"function"==typeof e.name?e.name():e.name}(e)||function(e){return"description"in e?e.description():e.message}(e)||function(e){const t=function(e){return"dataSource"in e?"symbol"===e.dataSource.type?e.dataSource.symbol:null:"function"==typeof e.symbol?(0,r.decodeExtendedSymbol)(e.symbol()):e.symbol}(e),i=function(e){if("dataSource"in e&&"watchlist"===e.dataSource.type)return e.dataSource.watchlistName;return null}(e),a="function"==typeof e.resolution?e.resolution():e.resolution,l="function"==typeof e.crossInterval?e.crossInterval():e.crossInterval;i&&function(e){const t=e.watchlistName;e.crossInterval||(0,s.formatAppendingResolutionString)(e.resolution)}({watchlistName:i,resolution:a,crossInterval:l});return(0,o.formatSymbolAndResolution)({symbol:(0,n.ensureNotNull)(t),resolution:a,crossInterval:l})}(e)}},565203:(e,t,i)=>{"use strict";i.d(t,{getAlertsChartActionCreators:()=>r});const r=(0,i(481251).default)((async()=>{const{getCreateAlertAction:e}=await Promise.all([i.e(16085),i.e(43853)]).then(i.bind(i,859740)),{getEditAlertOnLineDataSourceAction:t}=await Promise.all([i.e(16085),i.e(43853)]).then(i.bind(i,167222));return{createAlert:e,editAlertOnLineDataSource:t}}))},347505:(e,t,i)=>{"use strict";function r(e,t){const i=e.formatter();if(i.parse){const e=i.parse(i.format(t));if(e.res)return e.value}return t}i.d(t,{roundAlertValueUsingPrecision:()=>r})},
327052:(e,t,i)=>{"use strict";var r;i.d(t,{AlertStopReason:()=>r}),function(e){e[e.Auto=0]="Auto",e[e.Manual=1]="Manual",e[e.Expired=2]="Expired",e[e.Created=3]="Created"}(r||(r={}))},377464:(e,t,i)=>{"use strict";i.d(t,{formatAppendingResolutionString:()=>s});var r=i(64262),n=i(969680);function s(e){const t=(0,r.getTranslatedResolution)(e);return(0,n.isRtl)()?" "+(0,n.forceRTLStr)(" ,"+t):", "+t}},939037:(e,t,i)=>{"use strict";i.d(t,{formatSymbolAndResolution:()=>a,formatSymbolString:()=>l});var r=i(212363),n=i.n(r),s=i(955722),o=i(377464);function a(e,t){const i=l(e.symbol,t);if(e.crossInterval)return i;return i+(0,o.formatAppendingResolutionString)(e.resolution)}function l(e,t){let i=(0,s.unwrapSimpleSymbol)(e);return t||(i=n().shortName(i)),i}},335048:(e,t,i)=>{"use strict";i.d(t,{CubicBezier:()=>r.CubicBezier,color:()=>r.color,dur:()=>r.dur,easingFunc:()=>r.easingFunc});var r=i(745269)},699738:(e,t,i)=>{"use strict";function r(e){Promise.all([i.e(70752),i.e(18883),i.e(98185),i.e(46195),i.e(15371),i.e(32937),i.e(83439),i.e(61681),i.e(98933),i.e(25563),i.e(97540),i.e(72232),i.e(66032),i.e(13672),i.e(3359),i.e(84712),i.e(10445),i.e(1462),i.e(62112),i.e(19364),i.e(90024),i.e(82321),i.e(62526),i.e(9887),i.e(49693),i.e(49253),i.e(9374)]).then(i.bind(i,793497)).then((({SymbolInfoDialogImpl:t})=>{t.getInstance().show(e)}))}i.d(t,{showSymbolInfoDialog:()=>r})},674488:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" fill-rule="evenodd" d="M15 9A6 6 0 1 1 3 9a6 6 0 0 1 12 0Zm1 0A7 7 0 1 1 2 9a7 7 0 0 1 14 0ZM7.97 5.87l-.78-.52V12.65l.78-.52 4.02-2.72.62-.41-.62-.42-4.02-2.7Zm.22 4.9V7.23L10.82 9l-2.63 1.77Z"/></svg>'},30556:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M7.5 4a.5.5 0 0 0-.5.5V5h4v-.5a.5.5 0 0 0-.5-.5h-3ZM12 5h3v1h-1.05l-.85 7.67A1.5 1.5 0 0 1 11.6 15H6.4a1.5 1.5 0 0 1-1.5-1.33L4.05 6H3V5h3v-.5C6 3.67 6.67 3 7.5 3h3c.83 0 1.5.67 1.5 1.5V5ZM5.06 6l.84 7.56a.5.5 0 0 0 .5.44h5.2a.5.5 0 0 0 .5-.44L12.94 6H5.06Z"/></svg>'}}]);